!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VISION=t()}(this,(function(){"use strict";var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},e(t,i)};function t(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var i=function(){return i=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},i.apply(this,arguments)};function n(e,t,i){if(i||2===arguments.length)for(var n,s=0,a=t.length;s<a;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))}var s,a=function(){return"".concat(Date.now(),"-").concat(Math.floor(1e13*Math.random()))},r=function(e,t){return!!t&&t.split(",").reduce((function(e,t){return(t=t.replace(/\(.*\)/g,"").trim())&&e.push(t),e}),[]).indexOf(e.replace(/\(.*\)/g,"").trim())>-1},o=function(e){for(var t=new ArrayBuffer(e.length),i=new Uint8Array(t),n=0,s=e.length;n<s;n++)i[n]=e.charCodeAt(n);return t},c=function(){function e(e,t){var i=this;this.callback=e,this.store=t,this.adCount=1,this.adStartTime=0,this.adTimeSpent=0,this.previousAdTimeSpent=0,this.previousTimeSpent=0,this.startTime=0,this.timeSpent=0,t.subscribe((function(){return i.config=t.getState().config})),this.config=t.getState().config}return e.prototype.createMediaSession=function(e){this.sessionId||(e.event_name=e.event_name.replace("_play","_start"),this.sessionId=a(),this.dispatch(i(i({},e),{event_name:"media_init"})))},e.prototype.dispatch=function(e,t,n){void 0===t&&(t=!1);var s=(t&&n?n:this.adTimeSpent)/1e3||0,a=(!t&&n?n:this.timeSpent)/1e3||0,r=Date.now();if(t&&Math.abs(this.previousAdTimeSpent-s)>this.config.mediaAdHeartbeatSec+1)s=this.previousAdTimeSpent+this.config.mediaAdHeartbeatSec,this.adTimeSpent=1e3*s,this.adStartTime=r;else if(!t){var o=this.getHeartbeatInterval(e);Math.abs(this.previousTimeSpent-a)>o+1&&(a=this.previousTimeSpent+o,this.timeSpent=1e3*a,this.startTime=r)}this.previousAdTimeSpent=s,this.previousTimeSpent=a,this.callback(i(i({},e),{event_timestamp:r,media_ad_time_spent:s,media_session_id:this.sessionId,media_time_spent:a}))},e.prototype.dispatchMediaAdStop=function(e){var t=JSON.parse(e);t.event_name="media_ad_stop",this.dispatch(t,!0),this.adTimeSpent=0,this.previousAdTimeSpent=0,this.timeSpent=0,this.previousTimeSpent=0,this.adStartTime=0,this.sessionId=void 0},e.prototype.dispatchMediaStop=function(e){var t=JSON.parse(e);t.event_name="media_stop",this.adCount=1,this.dispatch(t),this.adTimeSpent=0,this.previousAdTimeSpent=0,this.timeSpent=0,this.previousTimeSpent=0,this.startTime=0,this.adStartTime=0,this.sessionId=void 0},e.prototype.getHeartbeatInterval=function(e){var t=e.media_content_length;return(null!=t?t:1/0)<this.config.mediaLengthShortSec?this.config.mediaHeartbeatShortSec:(null!=t?t:1/0)<this.config.mediaLengthMediumSec?this.config.mediaHeartbeatMediumSec:this.config.mediaHeartbeatLongSec},e.prototype.handleEvent=function(e){var t=Date.now();switch(e.event_name){case"media_ad_pause":if(!this.sessionId)return;window.clearInterval(this.adHeartbeatIntervalId),this.setAdPauseTimeout(e),this.adTimeSpent+=t-this.adStartTime,this.adStartTime=0,this.dispatch(e,!0);break;case"media_ad_play":window.clearTimeout(this.adPauseTimeoutId),this.createMediaSession(e),this.setAdHeartbeatInterval(e),this.adStartTime=t,this.dispatch(e,!0);break;case"media_ad_skipped":if(!this.sessionId)return;window.clearInterval(this.adHeartbeatIntervalId),window.clearTimeout(this.adPauseTimeoutId),this.timeSpent>0&&(this.setHeartbeatInterval(e),this.startTime=t),this.adCount+=1,this.adStartTime>0&&(this.adTimeSpent+=t-this.adStartTime),this.dispatch(e,!0),this.dispatch(i(i({},e),{event_name:"media_ad_stop"}),!0),this.adStartTime=0;break;case"media_ad_start":this.createMediaSession(e),this.setAdHeartbeatInterval(e),this.startTime>0&&(window.clearInterval(this.heartbeatIntervalId),this.timeSpent+=t-this.startTime,this.startTime=0),this.adStartTime=t,this.dispatch(e,!0);break;case"media_ad_stop":if(!this.sessionId)return;window.clearInterval(this.adHeartbeatIntervalId),window.clearTimeout(this.adPauseTimeoutId),this.timeSpent>0&&(this.setHeartbeatInterval(e),this.startTime=t),this.adCount+=1,this.adStartTime>0&&(this.adTimeSpent+=t-this.adStartTime),this.dispatch(e,!0),this.adStartTime=0;break;case"media_backward":if(!this.sessionId||0===this.startTime)return;this.timeSpent+=t-this.startTime,this.startTime=t,this.dispatch(e);break;case"media_buffer_end":case"media_buffer_start":case"media_forward":if(!this.sessionId)return;this.timeSpent+=t-this.startTime,this.startTime=t,this.dispatch(e);break;case"media_dispose_ad_stop":if(window.clearInterval(this.adHeartbeatIntervalId),window.clearInterval(this.heartbeatIntervalId),window.clearTimeout(this.adPauseTimeoutId),0===this.adStartTime)return;e.event_name="media_ad_stop",this.adCount+=1,this.adTimeSpent+=t-this.adStartTime,this.dispatch(e,!0),this.adTimeSpent=0,this.previousAdTimeSpent=0,this.timeSpent=0,this.previousTimeSpent=0,this.startTime=0,this.sessionId=void 0;break;case"media_pause":if(!this.sessionId||0===this.startTime)return;window.clearInterval(this.heartbeatIntervalId),this.setPauseTimeout(e),this.timeSpent+=t-this.startTime,this.startTime=0,this.dispatch(e);break;case"media_play":window.clearTimeout(this.pauseTimeoutId),this.createMediaSession(e),this.setHeartbeatInterval(e),this.startTime=t,this.dispatch(e);break;case"media_start":this.createMediaSession(e),this.setHeartbeatInterval(e),this.startTime=t,this.dispatch(e);break;case"media_stop":if(window.clearInterval(this.heartbeatIntervalId),window.clearTimeout(this.pauseTimeoutId),!this.sessionId)return;this.startTime>0&&(this.timeSpent+=t-this.startTime),this.adCount=1,this.dispatch(e),this.adTimeSpent=0,this.previousAdTimeSpent=0,this.timeSpent=0,this.previousTimeSpent=0,this.startTime=0,this.sessionId=void 0}},e.prototype.setAdHeartbeatInterval=function(e){var t=this;window.clearInterval(this.adHeartbeatIntervalId);var i=JSON.stringify(e);this.adHeartbeatIntervalId=window.setInterval((function(){var e=JSON.parse(i),n=Date.now()-t.adStartTime+t.adTimeSpent;e.event_name="media_ad_heartbeat",e.media_current_position=void 0,n>12e4*t.adCount?(window.clearInterval(t.adHeartbeatIntervalId),t.adTimeSpent=n,t.dispatchMediaAdStop(i)):t.dispatch(e,!0,n)}),1e3*this.config.mediaAdHeartbeatSec)},e.prototype.setAdPauseTimeout=function(e){var t=this;window.clearTimeout(this.adPauseTimeoutId),this.adPauseTimeoutId=window.setTimeout((function(){return t.dispatchMediaAdStop(JSON.stringify(e))}),1e3*this.config.mediaPauseTimeoutSec)},e.prototype.setHeartbeatInterval=function(e){var t=this;window.clearInterval(this.heartbeatIntervalId);var i=JSON.stringify(e);this.heartbeatIntervalId=window.setInterval((function(){var e=JSON.parse(i),n=Date.now()-t.startTime+t.timeSpent;e.event_name="media_heartbeat",e.media_current_position=void 0,e.media_content_length&&n>2*e.media_content_length*1e3?(window.clearInterval(t.heartbeatIntervalId),t.timeSpent=n,t.dispatchMediaStop(i)):t.dispatch(e,!1,n)}),1e3*this.getHeartbeatInterval(e))},e.prototype.setPauseTimeout=function(e){var t=this;window.clearTimeout(this.pauseTimeoutId),this.pauseTimeoutId=window.setTimeout((function(){return t.dispatchMediaStop(JSON.stringify(e))}),1e3*this.config.mediaPauseTimeoutSec)},e}(),d=function(e,t,n){var a=!1,r={},o=function(a){var r=i(i({},e.mediainfo),t),o=r.originalPublishDate||r.originalAirDate,c=o&&new Date(o),d=e.muted();s="media_start"===a&&"autostart"===r.startType&&"Autoplay Sound ".concat(d?"Off":"On")||s;var u={event_name:a,media_ad_id:e.ads&&e.ads.ad&&e.ads.ad.id,media_ad_id_source:r.adIdSource,media_air_date:c?c.toLocaleDateString():void 0,media_air_time:c?c.toLocaleTimeString():void 0,media_airing_id:r.simulcastAiringId||r.airingId,media_audio_language:e.language(),media_autoplay_sound:s,media_binge_play_count:parseInt(r.playlistCount,10)||void 0,media_channel:r.publisher,media_content_length:isFinite(e.duration())&&e.duration()||void 0,media_current_position:e.currentTime(),media_id:r.id,media_id_source:r.webHref,media_is_mute:d,media_league:r.leagueName,media_live:r.live,media_live_scoring:null!=r.liveScoring?"Live Scoring ".concat(r.liveScoring?"On":"Off"):void 0,media_name:r.headline||r.name,media_network_name:r.publisher,media_observed_bitrate:e.playbackRate(),media_play_location:r.playLocation,media_player_name:e.bcAnalytics&&e.bcAnalytics.settings&&e.bcAnalytics.settings.playerName,media_player_type:e.currentType(),media_player_version:e.bcAnalytics&&e.bcAnalytics.settings&&e.bcAnalytics.settings.platformVersion,media_playlist_id:r.playlistId,media_program_code:r.program,media_segment:r.segment,media_show_code:r.showcode,media_sport:r.sportName,media_start_type:r.startType,media_video_type:r.status||"vod",media_video_type_detail:r.custom_fields&&r.custom_fields.mediaType,media_viewing_mode:e.isFullscreen()?"full screen":"browse"};n(u,r)};e.hasStarted_&&!e.paused()&&(r.started=!0,o("media_start"));e.on("ads-ad-started",(function(){a=!0,o("media_ad_start")})),e.on("ads-ad-ended",(function(){o("media_ad_stop"),a=!1})),e.on("ads-play",(function(){o("media_ad_play")})),e.on("ads-pause",(function(){o("media_ad_pause")})),e.on("ads-ad-skipped",(function(){o("media_ad_skipped"),a=!1})),e.on("playing",(function(){a&&(o("media_ad_stop"),a=!1),r.started||(r.started=!0,o("media_start"))})),e.on("play",(function(){r.started&&r.paused&&(r.paused=!1,o("media_play"))})),e.on("pause",(function(){e.scrubbing()||e.seeking()||r.seeking||(r.paused=!0,o("media_pause"))})),e.on("ended",(function(){o("media_stop"),r.paused=null,r.started=null})),e.on("dispose",(function(){var t;e&&(t="object"==typeof e.ads&&e.ads.isAdPlaying()?"media_dispose_ad_stop":"media_stop",o(t)),r.started=!1})),e.on("seeking",(function(){0!==e.bufferedEnd()||r.buffering||(r.buffering=!0,o("media_buffer_start")),r.seeking=!0})),e.on("seeked",(function(){r.buffering&&(o("media_buffer_end"),r.buffering=!1);var t=parseFloat(r.lastUpdatedTime)<parseFloat(e.currentTime())?"media_forward":"media_backward";o(t),r.seeking=!1})),e.on("timeupdate",(function(){e.scrubbing()||e.seeking()||r.seeking||(r.lastUpdatedTime=e.currentTime())}))},u=function(e){return Object.getOwnPropertyNames(e).forEach((function(t){var i=e[t];"object"==typeof i&&null!=i&&u(i)})),Object.freeze(e)},p=function(e){return null==e||""===e||"null"===e||"undefined"===e||"object"==typeof e&&0===Object.keys(e).length},l=function(e){return"object"==typeof e&&null!=e&&"event_name"in e},_=function(e){return Array.isArray(e)&&e.every(l)},h=function(e){return!isNaN(e)&&e instanceof Date},v=function(){function e(e,t,i,n,s){var a=this;this.eventBus=e,this.logger=t,this.storage=i,this.store=n,this.xhr=s,n.subscribe((function(){a.config=n.getState().config;var e=a.pollConfigIntervalSec;a.pollConfigIntervalSec=a.config.pollConfigIntervalSec,null!=a.pollIntervalId&&e!==a.pollConfigIntervalSec&&a.setPollInterval()})),this.config=n.getState().config,this.pollConfigIntervalSec=this.config.pollConfigIntervalSec}return e.prototype.pollRemote=function(){var e=this;this.storage.getLocalItem("visionForceDisableCollection")||this.xhr.getConfig((function(t){return e.mergeRemote(t)}),!0)},e.prototype.mergeRemote=function(e){void 0===e&&(e={}),this.storage.setLocalItem("visionConfigTimestamp",Date.now()),this.storage.setLocalItem("visionConfiguration",e),this.update(e),this.logger.log(e)},e.prototype.run=function(){var e=this.storage.getLocalItem("visionConfigTimestamp");!e||(Date.now()-e)/1e3>=this.config.pollConfigIntervalSec?this.pollRemote():this.update(this.storage.getLocalItem("visionConfiguration")||{}),this.setPollInterval()},e.prototype.setPollInterval=function(){var e=this;window.clearInterval(this.pollIntervalId),this.pollIntervalId=window.setInterval((function(){return e.pollRemote()}),1e3*this.config.pollConfigIntervalSec)},e.prototype.update=function(e){this.store.dispatch({type:"config/update",config:e})},e}(),m=function(){function e(){this.events={}}return e.prototype.publish=function(e){for(var t,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];null===(t=this.events[e])||void 0===t||t.forEach((function(e){return e.apply(void 0,i)}))},e.prototype.subscribe=function(e,t){var i=this;Array.isArray(this.events[e])||(this.events[e]=[]),this.events[e].push(t);var n=this.events[e].length-1;return function(){return i.events[e].splice(n,1)}},e}(),f=function(){function e(e){this.store=e}return e.prototype.log=function(e,t){void 0===t&&(t="Debug"),this.store.getState().config.debugMode&&console.log("VISION Log (".concat(t,"):"),e)},e}(),g=function(){function e(e,t,i){var n=this;this.eventBus=e,this.storage=t,this.store=i,this.lastEvent=0,e.subscribe("client.unset-force-disable-collection",(function(){return n.create()})),i.subscribe((function(){n.config=i.getState().config;var e=n.pageHeartbeatInSeconds;n.pageHeartbeatInSeconds=n.config.pageHeartbeatInSeconds,null!=n.heartbeatIntervalId&&e!==n.pageHeartbeatInSeconds&&n.setHeartbeatInterval()})),this.config=i.getState().config,this.pageHeartbeatInSeconds=this.config.pageHeartbeatInSeconds}return e.prototype.create=function(){var e=Date.now(),t={active:e+18e5,event_session_sequence_num:0,expires:e+432e5,session_id:a(),session_start_timestamp:e,session_total_time:0,vision_id:a()};return this.storage.setLocalItem("visionSession",t),t},e.prototype.createAnonId=function(){var e={expires:Date.now()+33927469800,user_anonymous_id:a()};return this.storage.setLocalItem("visionAnonId",e),e},e.prototype.extend=function(){var e=this.readOrCreate(),t=Date.now();e.expires-t>0&&e.active-t>0?this.storage.setLocalItem("visionSession",i(i({},e),{active:t+18e5})):this.create()},e.prototype.readOrCreate=function(){var e=this.storage.getLocalItem("visionSession");return null!=e?e:this.create()},e.prototype.readOrCreateAnonId=function(){var e=this.storage.getLocalItem("visionAnonId");return null!=e&&e.expires-Date.now()>0?e:this.createAnonId()},e.prototype.run=function(){var e=this;this.eventBus.subscribe("tracking.activity",(function(){e.extend(),e.touchLastEvent()})),this.eventBus.subscribe("tracking.page",(function(t){return e.updatePageProperties(t)})),window.addEventListener("pagehide",(function(){return e.updateTimeSpent()})),window.document.addEventListener("scroll",(function(){return e.touchLastEvent()})),this.setHeartbeatInterval(),this.readOrCreateAnonId(),this.extend(),this.touchLastEvent(),this.store.dispatch({lastHeartbeat:Date.now(),type:"lastHeartbeat/update"})},e.prototype.setHeartbeatInterval=function(){var e=this;window.clearInterval(this.heartbeatIntervalId),this.heartbeatIntervalId=window.setInterval((function(){e.updateTimeSpent((function(){Date.now()-e.lastEvent<1e3*e.config.pageActiveThreshold?e.config.pageHeartbeatCollection&&e.eventBus.publish("session.page-heartbeat"):(e.eventBus.publish("session.page-close"),e.lastEvent=0)}))}),1e3*this.config.pageHeartbeatInSeconds)},e.prototype.touchLastEvent=function(){this.lastEvent=Date.now()},e.prototype.update=function(e){var t=this.readOrCreate(),n=Object.keys(e).reduce((function(i,n){var s=e[n];return i[n]="function"==typeof s?s(t[n]):s,i}),{});this.storage.setLocalItem("visionSession",i(i({},t),n))},e.prototype.updatePageProperties=function(e){var t=this.storage.getLocalItem("visionSession"),i={};if(!(null==t?void 0:t.session_first_referrer_url)){var n=this.storage.getSessionItem("visionPagePreviousUrl");n&&(i.session_first_referrer_url=n)}if(e.page_location&&!(null==t?void 0:t.session_first_page)&&(i.session_first_page=e.page_location),e.page_url&&!(null==t?void 0:t.session_first_url)&&(i.session_first_url=e.page_url),Object.keys(i).length>0&&this.update(i),"page_view"===e.event_name&&e.page_url){var s=this.storage.getSessionItem("visionPageUrl");s&&this.storage.setSessionItem("visionPagePreviousUrl",s)}},e.prototype.updateTimeSpent=function(e){var t=Date.now(),i=t-this.store.getState().lastHeartbeat;this.lastEvent>0&&i>0&&i<=1.1*this.config.pageHeartbeatInSeconds*1e3&&(null==e||e(),this.update({session_total_time:function(e){return e+i/1e3}})),this.store.dispatch({lastHeartbeat:t,type:"lastHeartbeat/update"})},e}(),y=function(){function e(){this.memo={},this.getLocalItem=e.createGetter("localStorage"),this.getSessionItem=e.createGetter("sessionStorage"),this.removeLocalItem=e.createRemover("localStorage"),this.removeSessionItem=e.createRemover("sessionStorage"),this.setLocalItem=e.createSetter("localStorage"),this.setSessionItem=e.createSetter("sessionStorage")}return e.createGetter=function(e){return function(t){if(this.isAvailable(e))try{return JSON.parse(window[e].getItem(t))}catch(i){return window[e].getItem(t)}}},e.createRemover=function(e){return function(t){this.isAvailable(e)&&window[e].removeItem(t)}},e.createSetter=function(e){return function(t,i){this.isAvailable(e)&&window[e].setItem(t,JSON.stringify(i))}},e.prototype.isAvailable=function(e){if(null==this.memo[e])try{var t=window[e],i="__storage_test__";t.setItem(i,i),t.removeItem(i),this.memo[e]=!0}catch(t){this.memo[e]=!1}return this.memo[e]},e}(),b=function(){function e(e){this.reducer=e,this.callbacks=[],this.state=u(e())}return e.prototype.dispatch=function(e){var t=this.reducer(this.state,e);this.state!==t&&(this.state=u(t),this.callbacks.forEach((function(e){return e()})))},e.prototype.getState=function(){return this.state},e.prototype.subscribe=function(e){var t=this;this.callbacks.push(e);var i=this.callbacks.length-1;return function(){return t.callbacks.splice(i,1)}},e}(),S={ad_id:"ad1",ad_creative:"ad2",ad_type:"ad3",ad_placement:"ad4",ad_orientation:"ad6",ad_destination_url:"ad7",ad_version:"ad8",ad_parent_type:"ad9",ad_parent_id:"ad10",ad_pod_number:"ad11",ad_pod_size:"ad12",api_url:"ap1",api_method:"ap2",api_response_time:"ap3",article_id:"ar1",article_id_source:"ar2",article_name:"ar3",event_name:"e2",event_instance_id:["e3",!0],event_session_sequence_num:["e4",!0],event_timestamp:"e6",event_log_timestamp:["e7",!0],event_test:"e10",funnel_type:"fn1",funnel_name:"fn2",funnel_milestone:"fn3",impression_id:"imp1",impression_id_source:"imp2",impression_type:"imp3",link_module_name:"l1",link_module_position:"l2",link_name:"l4",link_position:"l5",link_destination_location:"l7",link_destination_url:"l8",media_id:"m1",media_id_source:"m2",media_name:"m3",media_observed_bitrate:"m5",media_content_length:"m6",media_current_position:"m7",media_current_chapter:"m8",media_player_name:"m9",media_player_type:"m10",media_player_version:"m11",media_session_id:"m12",media_subtitle_language:"m16",media_audio_language:"m18",media_video_type:"m20",media_playlist_id:"m24",media_ad_id:"m26",media_ad_id_source:"m27",media_time_spent:"m28",media_ad_time_spent:"m29",media_live:"m30",media_viewing_mode:"m31",media_channel:"m32",media_air_date:"m33",media_air_time:"m34",media_airing_id:"m35",media_program_code:"m36",media_segment:"m37",media_sport:"m38",media_league:"m39",media_start_type:"m40",media_network_name:"m41",media_is_mute:"m42",media_live_scoring:"m43",media_autoplay_sound:"m45",media_video_type_detail:"m46",media_show_code:"m47",media_play_location:"m48",media_binge_play_count:"m53",page_location:["p1",!1,!0],page_url:["p2",!1,!0],page_id:["p3",!1,!0],page_id_source:["p4",!1,!0],page_instance_id:["p5",!1,!0],page_previous_url:["p6",!0,!0],page_z_axis:"p7",page_version:"p8",page_type:["p9",!1,!0],page_time_spent:"p10",page_user_mode:"p11",page_auth_flag:"p12",page_nav_method:"p13",page_premium_content:"p14",pzncon_event:"pc1",pzncon_personalized:"pc2",pzncon_curated:"pc3",pzncon_reason:"pc4",pzncon_rule:"pc5",pzncon_edition:"pc6",pzncon_slot_position:"pc7",pzncon_presentation_type:"pc8",pzncon_content_id:"pc9",pzncon_content_id_type:"pc10",pzncon_nav_method:"pc11",pzncon_clubhouse:"pc12",pzncon_feed_version:"pc13",pzncon_content_score:"pc14",pzncon_entitled:"pc15",pzncon_collection_id:"pc16",pzncon_collection_id_type:"pc17",pzncon_personal_metadata:"pc18",pzncon_originally_published:"pc19",pzncon_last_modified:"pc20",pzncon_content_title:"pc21",pzncon_personal_metadata_ids:"pc22",pzncon_premium:"pc23",pzncol_collection_id:"pcl1",pzncol_collection_id_type:"pcl2",pzncol_content_id:"pcl3",pznfav_event:"pf1",pznfav_entity_id:"pf2",pznfav_entity_type:"pf3",prompt_view:"pr1",prompt_input:"pr2",payment_id:"py1",payment_category:"py2",payment_balance:"py3",payment_type:"py4",payment_sub_type:"py5",payment_currency:"py6",payment_country:"py7",payment_amount:"py8",payment_partner:"py9",payment_item:"py10",payment_item_count:"py11",payment_pay_wall_shown:"py12",payment_program_data:"py13",registration_guest_id:"r1",registration_guest_id_domain:"r2",registration_flow:"r3",registration_step:"r4",state_cmp:["s1",!1,!0],state_test:["s2",!1,!0],state_orientation:["s3",!0],session_id:["se1",!0],session_language:["se2",!0],session_first_page:["se3",!0],session_first_url:["se4",!0],session_first_referrer_url:["se5",!0],session_start_timestamp:["se9",!0],session_total_time:["se10",!0],search_module:"sr1",search_type:"sr2",search_keyword_executed:"sr3",search_keyword_typed:"sr4",search_refinement:"sr5",search_results_count:"sr6"},I={app_bundle_id:["a1",!0],app_suite:["a2",!0],app_platform:["a3",!0],app_version:["a4",!0],app_logging_lib_version:["a5",!0],app_region:["a6",!0],app_country:["a7",!0],app_network:["a8",!0],app_zipcode:["a10",!0],app_id:["a11",!0],browser_height:["br2",!0],browser_width:["br3",!0],browser_cookies_flag:["br4",!0],browser_local_storage_flag:["br5",!0],browser_java_flag:["br6",!0],browser_plugins:["br8",!0],browser_flash_version:["br9",!0],device_height:["d5",!0],device_width:["d6",!0],device_advertiser_id:["d13",!0,!0],user_guest_id:["u1",!0],user_affiliate:["u2",!0,!0],user_mvpd_short_name:["u3",!0,!0],user_mvpd_name:["u4",!0,!0],user_subscriber_type:["u5",!0,!0],user_access_method:["u6",!0,!0],user_disney_plus_bundle:["u7",!0,!0],user_anonymous_id:["u8",!0],user_subscription_id:["u9",!0,!0],user_dss_id:["u10",!0,!0]},w={config:{app_bundle_id:"",app_id:"",app_platform:"",app_suite:"",app_version:"",collection:!0,compression:"none",disableAppVersions:"",disableMediaAppVersions:"",disableMediaSdkVersions:"",disableSdkVersions:"",flushAtEventCount:10,flushIntervalSec:60,mediaAdHeartbeatSec:5,mediaCollection:!0,mediaHeartbeatLongSec:20,mediaHeartbeatMediumSec:10,mediaHeartbeatShortSec:5,mediaLengthMediumSec:3600,mediaLengthShortSec:90,mediaPauseTimeoutSec:600,pageActiveThreshold:120,pageHeartbeatCollection:!1,pageHeartbeatInSeconds:60,pollConfigIntervalSec:600,privacy:!1,url:""},guestIds:[],lastHeartbeat:0,libVersion:"10.3.0"},T=function(e,t){switch(void 0===e&&(e=w),null==t?void 0:t.type){case"config/update":return i(i({},e),{config:i(i({},e.config),t.config)});case"guestIds/update":var s=["primary","secondary"].indexOf(t.guestIdType),a=e.guestIds.some((function(e){return e.id===t.guestId.id}));if(-1===s&&a)return e;var r=n([],e.guestIds,!0);return s>-1?r[s]=t.guestId:r.push(t.guestId),i(i({},e),{guestIds:r});case"lastHeartbeat/update":return i(i({},e),{lastHeartbeat:t.lastHeartbeat});default:return e}},A=function(){var e=window.navigator.plugins["Shockwave Flash 2.0"]||window.navigator.plugins["Shockwave Flash"],t=window.navigator.userAgent.toLowerCase();return"flash_version:".concat(e?function(e){var t=e.description.split(" "),i=t[2].split("."),n=i[0],s=i[1],a=""!==t[3]?t[3]:t[4];return[n,s,"d"===a[0]?a.slice(1):"r"===a[0]?a.replace(/^r(.?[^d]*).*/,"$1"):a].join(".")}(e):t.indexOf("webtv/2.6")>-1?"4":t.indexOf("webtv/2.5")>-1?"3":t.indexOf("webtv")>-1?"2":k()?function(){try{return new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash.7").GetVariable("$version")}catch(e){}try{var e=new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");return e.AllowScriptAccess="always",e.GetVariable("$version")}catch(e){}try{return new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"),"WIN 6,0,21,0"}catch(e){}try{return new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash.3").GetVariable("$version")}catch(e){}try{return new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash.3"),"WIN 3,0,18,0"}catch(e){}try{return new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash"),"WIN 2,0,0,11"}catch(e){}return"-1"}():"-1")},k=function(){return window.navigator.appVersion.indexOf("MSIE")>-1&&window.navigator.appVersion.toLowerCase().indexOf("win")>-1&&-1===window.navigator.userAgent.indexOf("Opera")},H=function(){function e(e,t){var i=this;this.storage=e,this.store=t,t.subscribe((function(){return i.config=t.getState().config})),this.config=t.getState().config}return e.prototype.app_bundle_id=function(){return this.config.app_bundle_id},e.prototype.app_country=function(){return this.config.app_country},e.prototype.app_id=function(){return this.config.app_id},e.prototype.app_logging_lib_version=function(){return this.store.getState().libVersion},e.prototype.app_network=function(){return this.config.app_network},e.prototype.app_platform=function(){return this.config.app_platform},e.prototype.app_region=function(){return this.config.app_region},e.prototype.app_suite=function(){return this.config.app_suite},e.prototype.app_version=function(){return this.config.app_version},e.prototype.app_zipcode=function(){return this.config.app_zipcode},e.prototype.browser_cookies_flag=function(){return window.navigator.cookieEnabled},e.prototype.browser_flash_version=function(){return A()},e.prototype.browser_height=function(){return Math.floor(window.innerHeight||window.document.body.clientHeight)},e.prototype.browser_local_storage_flag=function(){return this.storage.isAvailable("localStorage")},e.prototype.browser_java_flag=function(){return"function"==typeof window.navigator.javaEnabled&&window.navigator.javaEnabled()},e.prototype.browser_plugins=function(){var e;if(null!=(null===(e=window.navigator.plugins)||void 0===e?void 0:e.length))return Array.prototype.map.call(window.navigator.plugins,(function(e){return e.name})).join(";")},e.prototype.browser_width=function(){return Math.floor(window.innerWidth||window.document.body.clientWidth)},e.prototype.device_height=function(){return Math.floor(window.screen.height)},e.prototype.device_width=function(){return Math.floor(window.screen.width)},e.prototype.event_instance_id=function(){return a()},e.prototype.event_log_timestamp=function(){return Date.now()},e.prototype.event_session_sequence_num=function(){var e=this.storage.getLocalItem("visionSession");if(null!=e)return e.event_session_sequence_num+=1,this.storage.setLocalItem("visionSession",e),e.event_session_sequence_num},e.prototype.event_timestamp=function(e){return(null==e?void 0:e.event_timestamp)||Date.now()},e.prototype.pzncon_last_modified=function(e){var t=new Date(null==e?void 0:e.pzncon_last_modified);return h(t)?t.getTime():void 0},e.prototype.pzncon_originally_published=function(e){var t=new Date(null==e?void 0:e.pzncon_originally_published);return h(t)?t.getTime():void 0},e.prototype.session_first_page=function(){var e;return null===(e=this.storage.getLocalItem("visionSession"))||void 0===e?void 0:e.session_first_page},e.prototype.session_first_referrer_url=function(){var e;return null===(e=this.storage.getLocalItem("visionSession"))||void 0===e?void 0:e.session_first_referrer_url},e.prototype.session_first_url=function(){var e;return null===(e=this.storage.getLocalItem("visionSession"))||void 0===e?void 0:e.session_first_url},e.prototype.session_id=function(){var e;return null===(e=this.storage.getLocalItem("visionSession"))||void 0===e?void 0:e.session_id},e.prototype.session_language=function(){return window.navigator.language||window.navigator.browserLanguage},e.prototype.session_start_timestamp=function(){var e;return null===(e=this.storage.getLocalItem("visionSession"))||void 0===e?void 0:e.session_start_timestamp},e.prototype.session_total_time=function(){var e,t=Date.now()-this.store.getState().lastHeartbeat,i=t>0&&t<=1.1*this.config.pageHeartbeatInSeconds*1e3,n=(null===(e=this.storage.getLocalItem("visionSession"))||void 0===e?void 0:e.session_total_time)||0;return i?n+t/1e3:n},e.prototype.state_cmp=function(e){return(null==e?void 0:e.state_cmp)||(t="cmp",window.document.location.search.slice(1).split("&").reduce((function(e,i){var n=i.split("="),s=n[0],a=n[1];return null!=e||s!==t?e:null==a?"":decodeURIComponent(a)}),null));var t},e.prototype.state_orientation=function(){return window.matchMedia("(orientation: landscape)").matches?"landscape":"portrait"},e.prototype.user_anonymous_id=function(){var e;return null===(e=this.storage.getLocalItem("visionAnonId"))||void 0===e?void 0:e.user_anonymous_id},e.prototype.user_guest_id=function(){return this.store.getState().guestIds},e}(),E=function(){function e(e,t,i,n){var s=this;this.eventBus=e,this.storage=t,this.store=i,this.xhr=n,i.subscribe((function(){s.config=i.getState().config;var e=s.flushIntervalSec;s.flushIntervalSec=s.config.flushIntervalSec,null!=s.flushIntervalId&&e!==s.flushIntervalSec&&s.setFlushInterval()})),this.config=i.getState().config,this.flushIntervalSec=this.config.flushIntervalSec,this.trackingModel=new H(t,i)}return e.prototype.anonymize=function(e){var t=["a6","a7","a10","d13","u1","u2","u8","u10"],i=["se2"];Object.keys(e.global).forEach((function(i){t.indexOf(i)>-1&&delete e.global[i]})),null!=e.global.u9&&e.global.u9.forEach((function(e){delete e.id})),e.events.forEach((function(e){e.s4=!0,Object.keys(e).forEach((function(t){i.indexOf(t)>-1&&delete e[t]}))}))},e.prototype.batchEvents=function(e){(e=n(n([],(this.storage.getLocalItem("visionEvents")||[]).filter(this.isEventData),!0),e,!0)).length>=this.config.flushAtEventCount?(this.xhr.postEvents(this.createPayload(e)),this.storage.removeLocalItem("visionEvents")):this.storage.setLocalItem("visionEvents",e)},e.prototype.createEventData=function(e){var t=this;return e.map((function(e){return t.mapProperties(S,e)}))},e.prototype.createPayload=function(e){var t={global:this.mapProperties(I),events:e};return(this.config.privacy||this.storage.getSessionItem("visionStatePrivacy"))&&this.anonymize(t),t},e.prototype.handleEvents=function(e){var t=this;if(!this.isCollectionDisabled()){var i=e.reduce((function(e,i){if(/^media_/.test(i.event_name))return e;t.eventBus.publish("tracking.page",i);var n="pzncon"===i.event_name?"eventsToBatch":"eventsToPost";return e.isActivity=e.isActivity||-1===["page_close","page_heartbeat"].indexOf(i.event_name),e[n].push(i),e}),{eventsToBatch:[],eventsToPost:[],isActivity:!1}),n=i.eventsToBatch,s=i.eventsToPost;i.isActivity&&this.eventBus.publish("tracking.activity"),s.length>0&&this.xhr.postEvents(this.createPayload(this.createEventData(s))),n.length>0&&this.batchEvents(this.createEventData(n))}},e.prototype.isCollectionDisabled=function(){return!this.config.collection||r(this.store.getState().libVersion,this.config.disableSdkVersions)||r(this.config.app_version,this.config.disableAppVersions)||!!this.storage.getLocalItem("visionForceDisableCollection")},e.prototype.isMediaCollectionDisabled=function(){return!this.config.mediaCollection||r(this.store.getState().libVersion,this.config.disableMediaSdkVersions)||r(this.config.app_version,this.config.disableMediaAppVersions)||this.isCollectionDisabled()},e.prototype.mapProperties=function(e,t){var n=this,s=i({},t),a=Object.keys(e).reduce((function(i,a){var r,o=e[a],c=Array.isArray(o)?o:[o,!1],d=c[0],u=c[1],l=c[2];if(u||(r=null==t?void 0:t[a],delete s[a]),"function"==typeof n.trackingModel[a]&&(r=n.trackingModel[a](t)),l){var _="vision".concat(function(e){return e.split("_").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join("")}(a));p(r)?r=n.storage.getSessionItem(_):n.storage.setSessionItem(_,r)}return!p(r)&&(i[d]=r),i}),{}),r=Object.keys(s).reduce((function(e,t){return!p(s[t])&&(e[t]=s[t]),e}),{});return!p(r)&&(a.unmapped=r),a},e.prototype.isEventData=function(e){var t="e2"in e;return t&&Object.keys(e).forEach((function(t){return p(e[t])&&delete e[t]})),t},e.prototype.postBatch=function(){var e=(this.storage.getLocalItem("visionEvents")||[]).filter(this.isEventData);e.length&&!this.isCollectionDisabled()&&(this.xhr.postEvents(this.createPayload(e)),this.storage.removeLocalItem("visionEvents"))},e.prototype.postMedia=function(e){this.isMediaCollectionDisabled()||(this.eventBus.publish("tracking.page",e),this.eventBus.publish("tracking.activity"),this.xhr.postEvents(this.createPayload(this.createEventData([e])),!0))},e.prototype.run=function(){var e=this;this.eventBus.subscribe("session.page-close",(function(){return e.handleEvents([{event_name:"page_close"}])})),this.eventBus.subscribe("session.page-heartbeat",(function(){return e.handleEvents([{event_name:"page_heartbeat"}])})),this.setFlushInterval()},e.prototype.setFlushInterval=function(){var e=this;window.clearInterval(this.flushIntervalId),this.flushIntervalId=window.setInterval((function(){return e.postBatch()}),1e3*this.flushIntervalSec)},e}(),C={},M=new Array(15);function O(e,t){return 506832829*e>>>t}function D(e,t){return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)}function L(e,t,i){return e[t]===e[i]&&e[t+1]===e[i+1]&&e[t+2]===e[i+2]&&e[t+3]===e[i+3]}function P(e,t,i,n,s){return i<=60?(n[s]=i-1<<2,s+=1):i<256?(n[s]=240,n[s+1]=i-1,s+=2):(n[s]=244,n[s+1]=i-1&255,n[s+2]=i-1>>>8,s+=3),function(e,t,i,n,s){var a;for(a=0;a<s;a++)i[n+a]=e[t+a]}(e,t,n,s,i),s+i}function U(e,t,i,n){return n<12&&i<2048?(e[t]=1+(n-4<<2)+(i>>>8<<5),e[t+1]=255&i,t+2):(e[t]=2+(n-1<<2),e[t+1]=255&i,e[t+2]=i>>>8,t+3)}function z(e,t,i,n){for(;n>=68;)t=U(e,t,i,64),n-=64;return n>64&&(t=U(e,t,i,60),n-=60),U(e,t,i,n)}function B(e,t,i,n,s){for(var a=1;1<<a<=i&&a<=14;)a+=1;var r=32-(a-=1);void 0===M[a]&&(M[a]=new Uint16Array(1<<a));var o,c=M[a];for(o=0;o<c.length;o++)c[o]=0;var d,u,p,l,_,h,v,m,f,g,y=t+i,b=t,S=t,I=!0;if(i>=15)for(d=y-15,p=O(D(e,t+=1),r);I;){h=32,l=t;do{if(u=p,v=h>>>5,h+=1,l=(t=l)+v,t>d){I=!1;break}p=O(D(e,l),r),_=b+c[u],c[u]=t-b}while(!L(e,t,_));if(!I)break;s=P(e,S,t-S,n,s);do{for(m=t,f=4;t+f<y&&e[t+f]===e[_+f];)f+=1;if(t+=f,s=z(n,s,m-_,f),S=t,t>=d){I=!1;break}c[O(D(e,t-1),r)]=t-1-b,_=b+c[g=O(D(e,t),r)],c[g]=t-b}while(L(e,t,_));if(!I)break;p=O(D(e,t+=1),r)}return S<y&&(s=P(e,S,y-S,n,s)),s}function j(e){this.array=e}function x(){return"object"==typeof process&&"object"==typeof process.versions&&void 0!==process.versions.node}function N(e){return e instanceof Uint8Array&&(!x()||!Buffer.isBuffer(e))}function F(e){return e instanceof ArrayBuffer}j.prototype.maxCompressedLength=function(){var e=this.array.length;return 32+e+Math.floor(e/6)},j.prototype.compressToBuffer=function(e){var t,i=this.array,n=i.length,s=0,a=0;for(a=function(e,t,i){do{t[i]=127&e,(e>>>=7)>0&&(t[i]+=128),i+=1}while(e>0);return i}(n,e,a);s<n;)a=B(i,s,t=Math.min(n-s,65536),e,a),s+=t;return a},C.SnappyCompressor=j;var R=C.SnappyCompressor;var V=function(e){if(!(N(e)||F(e)||(t=e,x()&&Buffer.isBuffer(t))))throw new TypeError("Argument compressed must be type of ArrayBuffer, Buffer, or Uint8Array");var t,i=!1,n=!1;N(e)?i=!0:F(e)&&(n=!0,e=new Uint8Array(e));var s,a,r,o=new R(e),c=o.maxCompressedLength();if(i?(s=new Uint8Array(c),r=o.compressToBuffer(s)):n?(s=new ArrayBuffer(c),a=new Uint8Array(s),r=o.compressToBuffer(a)):(s=Buffer.alloc(c),r=o.compressToBuffer(s)),!s.slice){var d=new Uint8Array(Array.prototype.slice.call(s,0,r));if(i)return d;if(n)return d.buffer;throw new Error("Not implemented")}return s.slice(0,r)},q=function(){function e(e,t,i){var n=this;this.logger=e,this.storage=t,i.subscribe((function(){return n.config=i.getState().config})),this.config=i.getState().config}return e.prototype.setHeaders=function(e,t,i){void 0===i&&(i=!1);var n=this.storage.getLocalItem("visionSession"),s=function(e,t){for(var i=e.concat(t),n=i.length,s=[7,11],a=[71,173],r=[2277735313,289559509],o=[1291169091,658871167],c=0;c<n;c++)s=[(s[0]<<5)-s[0]+i.charCodeAt(c),(s[1]<<3)-s[1]+i.charCodeAt(c)],a=[(a[0]<<4)-a[0]+i.charCodeAt(c),(a[1]<<6)-a[1]+i.charCodeAt(c)],s=[s[0]^r[0],s[1]^r[1]],a=[a[0]^o[0],a[1]^o[1]];return"00000000".concat((s[0]>>>0).toString(16)).slice(-8)+"00000000".concat((s[1]>>>0).toString(16)).slice(-8)+"00000000".concat((a[0]>>>0).toString(16)).slice(-8)+"00000000".concat((a[1]>>>0).toString(16)).slice(-8)}(n.session_id,"vision");e.setRequestHeader("App-Id",this.config.app_id),e.setRequestHeader("Authorization",s),e.setRequestHeader("Session-Id",n.session_id),e.setRequestHeader("Suite",this.config.app_suite),e.setRequestHeader("Vauth",s),e.setRequestHeader("Vision-Id",n.vision_id),null!=t&&(e.setRequestHeader("Accept","application/json"),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Event-Count",t.events.length.toString()),this.config.debugMode||"snappy"!==this.config.compression||e.setRequestHeader("Content-Encoding","snappy"),i&&"string"==typeof t.events[0].m12&&(e.setRequestHeader("Event-Type",t.events[0].e2),e.setRequestHeader("Media-Session-Id",t.events[0].m12)))},e.prototype.getConfig=function(e,t){var i=this;void 0===t&&(t=!0);var n=new XMLHttpRequest;n.onreadystatechange=function(){var s;if(4===n.readyState){200===n.status&&e(null===(s=JSON.parse(n.responseText))||void 0===s?void 0:s.config);var a=n.status>=400&&n.status<=500;a&&t?i.getConfig(e,!1):a&&i.logger.log(n.statusText,"Error")}},n.open("GET","".concat(this.config.url.replace(/\/+$/,""),"/config/").concat(this.config.app_suite),!0),n.withCredentials=!0,this.setHeaders(n),n.send()},e.prototype.postEvents=function(e,t,i){var n=this;if(void 0===t&&(t=!1),void 0===i&&(i=!0),0!==e.events.length){var s=new XMLHttpRequest;s.onreadystatechange=function(){if(4===s.readyState){var a=s.status>=400&&s.status<=500;a&&i?n.postEvents(e,t,!1):a&&n.logger.log(s.statusText,"Error")}},s.open("POST","".concat(this.config.url.replace(/\/+$/,""),"/").concat(t?"media":"event"),!0),s.withCredentials=!0,this.setHeaders(s,e,t);var a=this.config.debugMode||"snappy"!==this.config.compression?JSON.stringify(e):new Blob([V(o(JSON.stringify(e)))],{type:"text/plain"});s.send(a)}},e}(),J=function(){function e(){var e;this._callQueue=[],this._eventBus=new m,this._isInitialized=!1,this._storage=new y,this._store=new b(T),this._logger=new f(this._store);var t=new q(this._logger,this._storage,this._store);return this._configService=new v(this._eventBus,this._logger,this._storage,this._store,t),this._sessionService=new g(this._eventBus,this._storage,this._store),this._trackingService=new E(this._eventBus,this._storage,this._store,t),this.constructor._instance=null!==(e=this.constructor._instance)&&void 0!==e?e:this,this.constructor._instance}var t;return e._createAdder=function(e){return this._wrap((function(t,i){var s=this.getInstance(),a=s._storage.getSessionItem(e)||[];!a.some((function(e){return e.id===t}))&&s._storage.setSessionItem(e,n(n([],a,!0),[{id:t,s:i}],!1))}))},e._createSetter=function(e){return this._wrap((function(t){this.getInstance()._storage.setSessionItem(e,t)}))},e._createUnsetter=function(e,t){return this._wrap((function(i){var n=this.getInstance(),s=n._storage.getSessionItem(e)||[],a=s.filter((function(e){return e[t]!==i}));s.length!==a.length&&n._storage.setSessionItem(e,a)}))},e._createUnsetterAll=function(e){return this._wrap((function(){this.getInstance()._storage.removeSessionItem(e)}))},e._wrap=function(e){return function(){for(var t=this,i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];var a=this.getInstance();a._isInitialized?e.call.apply(e,n([this],i,!1)):a._callQueue.push((function(){return e.call.apply(e,n([t],i,!1))}))}},e.getInstance=function(){var e;return null!==(e=this._instance)&&void 0!==e?e:new this},e.setConfigs=function(e){if(null==e?void 0:e.url){var t=this.getInstance();t._configService.update(e),t._isInitialized||(t._storage.setSessionItem("visionPagePreviousUrl",window.document.referrer||"na"),t._storage.setSessionItem("visionPageInstanceId",a()),t._sessionService.run(),t._configService.run(),t._trackingService.run(),t._callQueue.splice(0,t._callQueue.length).forEach((function(e){return e()})),t._isInitialized=!0)}else console.error("VISION API enpoint missing")},e.setForceDisableCollection=function(){this.getInstance()._storage.setLocalItem("visionForceDisableCollection",!0)},e.unsetForceDisableCollection=function(){var e=this.getInstance();e._storage.removeLocalItem("visionForceDisableCollection"),e._eventBus.publish("client.unset-force-disable-collection")},t=e,e.addDssId=t._createAdder("visionUserDssId"),e.addGuestId=t._wrap((function(e,t,i,n){this.getInstance()._store.dispatch({guestId:{id:e,l:!!i,s:t},guestIdType:n,type:"guestIds/update"})})),e.addSubscriptionId=t._wrap((function(e,t){var i=this.getInstance(),s="visionUserSubscriptionId",a=i._storage.getSessionItem(s)||[],r=null!=t?[t,e]:[e],o=r[0],c=r[1];!a.some((function(e){return e.id===c&&e.s===o}))&&i._storage.setSessionItem(s,n(n([],a,!0),[{id:c,s:o}],!1))})),e.addTest=t._createAdder("visionStateTest"),e.setAccessMethod=t._createSetter("visionUserAccessMethod"),e.setAdvertiserId=t._createSetter("visionDeviceAdvertiserId"),e.setAffiliate=t._createSetter("visionUserAffiliate"),e.setDisneyPlusBundle=t._createSetter("visionUserDisneyPlusBundle"),e.setMvpdName=t._createSetter("visionUserMvpdName"),e.setMvpdShortName=t._createSetter("visionUserMvpdShortName"),e.setPrivacy=t._createSetter("visionStatePrivacy"),e.setSubscriberType=t._createSetter("visionUserSubscriberType"),e.unsetAccessMethod=t._createUnsetterAll("visionUserAccessMethod"),e.unsetAdvertiserId=t._createUnsetterAll("visionDeviceAdvertiserId"),e.unsetAffiliate=t._createUnsetterAll("visionUserAffiliate"),e.unsetAllDssId=t._createUnsetterAll("visionUserDssId"),e.unsetAllSubscriptionId=t._createUnsetterAll("visionUserSubscriptionId"),e.unsetAllTest=t._createUnsetterAll("visionStateTest"),e.unsetDisneyPlusBundle=t._createUnsetterAll("visionUserDisneyPlusBundle"),e.unsetDssId=t._createUnsetter("visionUserDssId","id"),e.unsetMvpdName=t._createUnsetterAll("visionUserMvpdName"),e.unsetMvpdShortName=t._createUnsetterAll("visionUserMvpdShortName"),e.unsetPrivacy=t._createUnsetterAll("visionStatePrivacy"),e.unsetSubscriberType=t._createUnsetterAll("visionUserSubscriberType"),e.unsetSubscriptionId=t._createUnsetter("visionUserSubscriptionId","s"),e.unsetTest=t._createUnsetter("visionStateTest","id"),e}(),G=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.track=t.constructor._wrap((function(e){e=Array.isArray(e)?e:[e],_(e)?t._trackingService.handleEvents(e):t._logger.log("Missing property event_name. Event not sent","Error")})).bind(t.constructor),t}return t(i,e),i}(J),X=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._mediaInstances=[],t.trackMedia=n._wrap((function(e){if(l(e)){var n=t._mediaInstances.reduce((function(t,i,n){var s=i.id;return-1===t&&s===e.media_id?n:t}),-1);if(n>-1){var s="media_pause"===e.event_name&&Math.abs(e.media_content_length-e.media_current_position)<1,a=t._mediaInstances[n].instance;t._lastMediaEvent=i({},e),s&&window.setTimeout((function(){var e;"media_pause"===(null===(e=t._lastMediaEvent)||void 0===e?void 0:e.event_name)&&(t._lastMediaEvent.event_name="media_stop",a.handleEvent(t._lastMediaEvent))}),2e3),a.handleEvent(e),"media_stop"===e.event_name&&t._mediaInstances.splice(n,1)}else if(["media_ad_start","media_start"].indexOf(e.event_name)>-1){var r=new c((function(e){return t._trackingService.postMedia(e)}),t._store);t._mediaInstances.push({id:e.media_id,instance:r}),r.handleEvent(e)}}else t._logger.log("Missing property event_name. Event not sent","Error")})).bind(n),t}return t(n,e),n.videojsPlugin=d,n}(G);return X}));
