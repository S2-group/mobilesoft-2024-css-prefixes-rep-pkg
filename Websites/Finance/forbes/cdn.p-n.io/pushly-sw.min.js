/*! For license information please see pushly-sw.min.js.LICENSE */
!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s="./src/sw.ts")}({"./node_modules/error-stack-parser/error-stack-parser.js":function(t,e,n){var r,i,o;!function(s,a){"use strict";i=[n("./node_modules/stackframe/stackframe.js")],void 0===(o="function"==typeof(r=function(t){var e=/(^|@)\S+\:\d+/,n=/^\s*at .*(\S+\:\d+|\(native\))/m,r=/^(eval@)?(\[native code\])?$/;return{parse:function(t){if(void 0!==t.stacktrace||void 0!==t["opera#sourceloc"])return this.parseOpera(t);if(t.stack&&t.stack.match(n))return this.parseV8OrIE(t);if(t.stack)return this.parseFFOrSafari(t);throw new Error("Cannot parse given Error object")},extractLocation:function(t){if(-1===t.indexOf(":"))return[t];var e=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/.exec(t.replace(/[\(\)]/g,""));return[e[1],e[2]||void 0,e[3]||void 0]},parseV8OrIE:function(e){var r=e.stack.split("\n").filter(function(t){return!!t.match(n)},this);return r.map(function(e){e.indexOf("(eval ")>-1&&(e=e.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var n=e.replace(/^\s+/,"").replace(/\(eval code/g,"(").split(/\s+/).slice(1),r=this.extractLocation(n.pop()),i=n.join(" ")||void 0,o=["eval","<anonymous>"].indexOf(r[0])>-1?void 0:r[0];return new t({functionName:i,fileName:o,lineNumber:r[1],columnNumber:r[2],source:e})},this)},parseFFOrSafari:function(e){var n=e.stack.split("\n").filter(function(t){return!t.match(r)},this);return n.map(function(e){if(e.indexOf(" > eval")>-1&&(e=e.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),-1===e.indexOf("@")&&-1===e.indexOf(":"))return new t({functionName:e});var n=/((.*".+"[^@]*)?[^@]*)(?:@)/,r=e.match(n),i=r&&r[1]?r[1]:void 0,o=this.extractLocation(e.replace(n,""));return new t({functionName:i,fileName:o[0],lineNumber:o[1],columnNumber:o[2],source:e})},this)},parseOpera:function(t){return!t.stacktrace||t.message.indexOf("\n")>-1&&t.message.split("\n").length>t.stacktrace.split("\n").length?this.parseOpera9(t):t.stack?this.parseOpera11(t):this.parseOpera10(t)},parseOpera9:function(e){for(var n=/Line (\d+).*script (?:in )?(\S+)/i,r=e.message.split("\n"),i=[],o=2,s=r.length;o<s;o+=2){var a=n.exec(r[o]);a&&i.push(new t({fileName:a[2],lineNumber:a[1],source:r[o]}))}return i},parseOpera10:function(e){for(var n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=e.stacktrace.split("\n"),i=[],o=0,s=r.length;o<s;o+=2){var a=n.exec(r[o]);a&&i.push(new t({functionName:a[3]||void 0,fileName:a[2],lineNumber:a[1],source:r[o]}))}return i},parseOpera11:function(n){var r=n.stack.split("\n").filter(function(t){return!!t.match(e)&&!t.match(/^Error created at/)},this);return r.map(function(e){var n,r=e.split("@"),i=this.extractLocation(r.pop()),o=r.shift()||"",s=o.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;o.match(/\(([^\)]*)\)/)&&(n=o.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var a=void 0===n||"[arguments not available]"===n?void 0:n.split(",");return new t({functionName:s,args:a,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:e})},this)}}})?r.apply(e,i):r)||(t.exports=o)}()},"./node_modules/stackframe/stackframe.js":function(t,e,n){var r,i,o;!function(n,s){"use strict";i=[],void 0===(o="function"==typeof(r=function(){function t(t){return!isNaN(parseFloat(t))&&isFinite(t)}function e(t){return t.charAt(0).toUpperCase()+t.substring(1)}function n(t){return function(){return this[t]}}var r=["isConstructor","isEval","isNative","isToplevel"],i=["columnNumber","lineNumber"],o=["fileName","functionName","source"],s=r.concat(i,o,["args"]);function a(t){if(t instanceof Object)for(var n=0;n<s.length;n++)t.hasOwnProperty(s[n])&&void 0!==t[s[n]]&&this["set"+e(s[n])](t[s[n]])}a.prototype={getArgs:function(){return this.args},setArgs:function(t){if("[object Array]"!==Object.prototype.toString.call(t))throw new TypeError("Args must be an Array");this.args=t},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(t){if(t instanceof a)this.evalOrigin=t;else{if(!(t instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new a(t)}},toString:function(){var e=this.getFunctionName()||"{anonymous}",n="("+(this.getArgs()||[]).join(",")+")",r=this.getFileName()?"@"+this.getFileName():"",i=t(this.getLineNumber())?":"+this.getLineNumber():"",o=t(this.getColumnNumber())?":"+this.getColumnNumber():"";return e+n+r+i+o}};for(var c=0;c<r.length;c++)a.prototype["get"+e(r[c])]=n(r[c]),a.prototype["set"+e(r[c])]=function(t){return function(e){this[t]=Boolean(e)}}(r[c]);for(var u=0;u<i.length;u++)a.prototype["get"+e(i[u])]=n(i[u]),a.prototype["set"+e(i[u])]=function(e){return function(n){if(!t(n))throw new TypeError(e+" must be a Number");this[e]=Number(n)}}(i[u]);for(var l=0;l<o.length;l++)a.prototype["get"+e(o[l])]=n(o[l]),a.prototype["set"+e(o[l])]=function(t){return function(e){this[t]=String(e)}}(o[l]);return a})?r.apply(e,i):r)||(t.exports=o)}()},"./src/_utils/base64.ts":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.base64ToArrayBuffer=e.arrayBufferToBase64=e.atobShim=void 0,e.atobShim=function(t){var e="";try{if("string"==typeof(e=self.atob(t)))return e}catch(t){}e="";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(t=String(t).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(t))throw new TypeError("Failed to execute 'atob' on 'self': The string to be decoded is not correctly encoded.");t+="==".slice(2-(3&t.length));for(var r,i,o,s=0;s<t.length;)r=n.indexOf(t.charAt(s++))<<18|n.indexOf(t.charAt(s++))<<12|(i=n.indexOf(t.charAt(s++)))<<6|(o=n.indexOf(t.charAt(s++))),e+=64===i?String.fromCharCode(r>>16&255):64===o?String.fromCharCode(r>>16&255,r>>8&255):String.fromCharCode(r>>16&255,r>>8&255,255&r);return e},e.arrayBufferToBase64=function(t){var e=new Uint8Array(t);return self.btoa(String.fromCharCode.apply(null,e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},e.base64ToArrayBuffer=function(t){for(var n=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),r=e.atobShim(n),i=new Uint8Array(r.length),o=0;o<r.length;++o)i[o]=r.charCodeAt(o);return i}},"./src/_utils/noop.ts":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.noop=void 0,e.noop=function(){}},"./src/_utils/wrap.ts":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.wrap=void 0,e.wrap=function(t,e){return function(){try{return t.apply(this,arguments)}catch(t){e&&e(t)}}}},"./src/sw.ts":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=new(n("./src/worker/custom/deep-blue.ts").DeepBlueWorker);self.PushlySW=r},"./src/worker/abstract-worker.ts":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(s,a)}c((r=r.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractWorker=void 0;var a=n("./src/worker/models/streamable-event.model.ts"),c=n("./src/worker/enums/streamable-event-type.enum.ts"),u=n("./src/worker/enums/action-destination-type.enum.ts"),l=n("./src/_utils/wrap.ts"),f=n("./src/worker/utils.ts"),p=n("./src/worker/constants.ts"),h=n("./src/worker/enums/event-action.enum.ts"),d=n("./src/worker/enums/notification-postback-type.enum.ts"),v=n("./src/_utils/base64.ts"),b=n("./src/worker/logger.ts"),y=n("./src/worker/api.data-provider.ts"),g=n("./src/worker/models/eventable.model.ts"),_=n("./node_modules/error-stack-parser/error-stack-parser.js"),m=/Windows NT 10/i,w=l.wrap(function(t,e){"object"==typeof t&&(t.context=i(i({},t.context||{}),e))}),N=function(t){function e(){var e=t.call(this)||this;return e.recentlyClickedNotificationTags=[],e.distributionName="base-worker",e.applicationVersion=p.APPLICATION_VERSION,e.logger=b.Logger,e.ensureDependencies(),e.resetRecentlyClicked(),e.init(),e.wireEvents(),e.logger.info("ServiceWorker started"),e}return r(e,t),e.prototype.wireEvents=function(){self.addEventListener("pushsubscriptionchange",this.onPushSubscriptionChange.bind(this)),self.addEventListener("install",this.onInstall.bind(this)),self.addEventListener("activate",this.onActivate.bind(this)),self.addEventListener("push",this.onPushEvent.bind(this)),self.addEventListener("notificationclick",this.onNotificationClick.bind(this)),self.addEventListener("notificationclose",this.onNotificationClose.bind(this))},e.prototype.onInstall=function(t){this.logger.info("Install"),t.waitUntil(self.skipWaiting())},e.prototype.onActivate=function(t){this.logger.info("Activate"),t.waitUntil(self.clients.claim())},e.prototype.onPushSubscriptionChange=function(t){this.logger.info("Got subscription change event"),t.waitUntil(this.handlePushSubscriptionChange(t))},e.prototype.onPushEvent=function(t){if(this.logger.info("Got push event:",t),!Notification||"granted"!==Notification.permission)return this.logger.info("Notification permission was not granted. Returning"),void t.waitUntil(self.skipWaiting());t.waitUntil(this.handleNotificationPush(t))},e.prototype.onNotificationClick=function(t){this.logger.info("Got click event",t),this.addRecentlyClicked(t),t.waitUntil(this.handleNotificationClick(t))},e.prototype.onNotificationClose=function(t){this.logger.info("Got close event",t),t.waitUntil(this.handleNotificationClose(t))},e.prototype.handlePushSubscriptionChange=function(t){return o(this,void 0,void 0,function(){var e,n,r,i;return s(this,function(o){switch(o.label){case 0:return o.trys.push([0,4,,6]),[4,this.processSubscriptionUpdate(t)];case 1:return(e=o.sent())?(n=e.newSubscription,r=e.oldSubscription,[4,this.sendSubscriptionChangeEvents(t,{subscription_data:n?n.toJSON():void 0,old_subscription_data:r?r.toJSON():void 0})]):[3,3];case 2:o.sent(),o.label=3;case 3:return[3,6];case 4:return i=o.sent(),w(i,{function_ref:"processSubscriptionUpdate"}),[4,this.sendErrorWithCode(i,"subscription_change_error")];case 5:return o.sent(),[3,6];case 6:return[2]}})})},e.prototype.handleNotificationPush=function(t){return o(this,void 0,void 0,function(){var e,n,r,i,o,a,c;return s(this,function(s){switch(s.label){case 0:return[4,this.getPushEventJson(t)];case 1:e=s.sent(),n=e.notification.title||"New Content Available",r=this.buildNotification(e),i=null,o=null,this.logger.info("Showing Notification:",n,JSON.stringify(r)),s.label=2;case 2:return s.trys.push([2,4,,5]),[4,self.registration.showNotification(n,r)];case 3:return s.sent(),[3,5];case 4:return a=s.sent(),i=a,o="failed_notification_show",[3,5];case 5:if(o)return[3,10];s.label=6;case 6:return s.trys.push([6,9,,10]),[4,this.sendImpressionEvents(e)];case 7:return s.sent(),[4,this.sendPostbackEvents("impression",e.data)];case 8:return s.sent(),[3,10];case 9:return c=s.sent(),i=c,o="notification_push_error",[3,10];case 10:return o?(console.error("handleNotificationPush Failure: code="+o+", err="+i),w(i,{notification:e}),[4,this.sendErrorWithCode(i,o)]):[3,13];case 11:return s.sent(),[4,this.handleUnsupportedPush(t)];case 12:s.sent(),s.label=13;case 13:return[2]}})})},e.prototype.handleUnsupportedPush=function(t){return o(this,void 0,void 0,function(){var t,e,n,r,i,o,a;return s(this,function(s){switch(s.label){case 0:this.logger.info("In handleUnsupportedPush"),s.label=1;case 1:return s.trys.push([1,8,,10]),[4,this.processReSubscribe()];case 2:t=s.sent(),e=t.domain,n={default_notification:!0,notification:{title:"New Content Available"},data:{icon:e?e.default_icon_url:void 0,landing_url:e&&e.name?"https://"+e.name:void 0,require_interaction:"false",silent:"true"}},r=n.notification.title,i=this.buildNotification(n),this.logger.info("Showing DEFAULT Notification:",r,JSON.stringify(i)),s.label=3;case 3:return s.trys.push([3,5,,7]),[4,self.registration.showNotification(r,i)];case 4:return s.sent(),[3,7];case 5:return o=s.sent(),this.logger.error("Unhandled foreign push event error",o),w(o,{notification:n}),[4,this.sendErrorWithCode(o,"failed_foreign_notification_show")];case 6:return s.sent(),[3,7];case 7:return[3,10];case 8:return a=s.sent(),this.logger.error("Unhandled unsupported event error",a),w(a,{function_ref:"handleUnsupportedPush"}),[4,this.sendErrorWithCode(a,"unsupported_push_error")];case 9:return s.sent(),[3,10];case 10:return[2]}})})},e.prototype.handleNotificationClick=function(t){return o(this,void 0,void 0,function(){var e,n,r,i,a,c,l,f=this;return s(this,function(p){switch(p.label){case 0:e=t.action||"open";try{isNaN(e)||(e=parseInt(e))}catch(t){}if(t.notification.close(),!t.notification.data)return[3,10];n=t.notification.data||{},r=this.getActionPackage(e,n),i=!!r.destination,a=function(n,r,i,a){return void 0===a&&(a=!1),o(f,void 0,void 0,function(){var r,o,c;return s(this,function(s){switch(s.label){case 0:return"win-close"===e?[3,6]:a?(o=void 0,[3,3]):[3,1];case 1:return[4,this.getSubscriptionData()];case 2:o=s.sent(),s.label=3;case 3:return r=o,c={},i&&(c.action_id=e),r&&(c.subscription_data=r),"number"!=typeof e&&delete c.action_id,[4,this.sendClickEvents(t,c)];case 4:return s.sent(),[4,this.sendPostbackEvents(e,n)];case 5:s.sent(),s.label=6;case 6:return[2]}})})},c=function(t,e,n){return o(f,void 0,void 0,function(){var r;return s(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,6]),[4,self.clients.matchAll({type:"window"})];case 1:return i.sent(),n?e.destination.type!==u.ActionDestinationType.LINK?[3,3]:[4,clients.openWindow(e.destination.url)]:[3,3];case 2:i.sent(),i.label=3;case 3:return[3,6];case 4:return r=i.sent(),w(r,{notification:t}),[4,this.sendErrorWithCode(r,"failed_click_action")];case 5:return i.sent(),[3,6];case 6:return[2]}})})},p.label=1;case 1:return p.trys.push([1,7,,9]),0!==n.jxms?[3,4]:(this.logger.info("JXMS Not Set. Running click actions in order."),[4,a(n,r,i,!0)]);case 2:return p.sent(),this.logger.info("click event streams completed"),[4,c(n,r,i)];case 3:return p.sent(),this.logger.info("click event actions completed"),[3,6];case 4:return this.logger.info("JXMS Set. Running click actions in parallel."),[4,Promise.all([c(n,r,i).then(function(){return f.logger.info("click event actions completed")}),a(n,r,i).then(function(){return f.logger.info("click event streams completed")})])];case 5:p.sent(),p.label=6;case 6:return[3,9];case 7:return l=p.sent(),this.logger.error("Unhandled click event error",l),w(l,{notification:n}),[4,this.sendErrorWithCode(l,"notification_click_error")];case 8:return p.sent(),[3,9];case 9:return[3,12];case 10:return this.logger.error("User clicked empty notification"),[4,this.sendErrorWithCode({},"empty_notification_on_click_error")];case 11:p.sent(),p.label=12;case 12:return[2]}})})},e.prototype.handleNotificationClose=function(t){return o(this,void 0,void 0,function(){var e;return s(this,function(n){switch(n.label){case 0:if(!t.notification.data)return[3,7];n.label=1;case 1:return n.trys.push([1,4,,6]),[4,this.sendCloseEvents(t,{})];case 2:return n.sent(),[4,this.sendPostbackEvents("close",t.notification.data)];case 3:return n.sent(),[3,6];case 4:return e=n.sent(),this.logger.error("Unhandled close event error",e),w(e,{notification:t.notification.data}),[4,this.sendErrorWithCode(e,"notification_close_error")];case 5:return n.sent(),[3,6];case 6:return[3,9];case 7:return this.logger.error("User closed empty notification"),[4,this.sendErrorWithCode({},"empty_notification_on_close_error")];case 8:n.sent(),n.label=9;case 9:return[2]}})})},e.prototype.getDomain=function(){return o(this,void 0,void 0,function(){var t,e,n,r,i,o;return s(this,function(s){switch(s.label){case 0:return t=self.location.search,!(e=t.match(/domain(?:key|_key)=([^&]+)/i))||e.length<=1?[2,null]:(n=e[1],r=p.CDN_ENDPOINT+"/domain-settings/"+n,[4,this.postback(d.NotificationPostbackType.GET,r)]);case 1:return i=s.sent(),(o=(i||{}).domain)&&this.logger.info("Obtained domain information",o),[2,o]}})})},e.prototype.processSubscriptionUpdate=function(t){return o(this,void 0,void 0,function(){var e,n,r;return s(this,function(i){switch(i.label){case 0:return t.oldSubscription?(e=t.oldSubscription.options,[3,3]):[3,1];case 1:return[4,this.getDomain()];case 2:(n=i.sent())&&(e={userVisibleOnly:!0,applicationServerKey:v.base64ToArrayBuffer(n.vapid_public_key)}),i.label=3;case 3:if(!e)return[3,8];i.label=4;case 4:return i.trys.push([4,6,,8]),[4,self.registration.pushManager.subscribe(e)];case 5:return[2,{newSubscription:i.sent(),oldSubscription:t.oldSubscription}];case 6:return r=i.sent(),[4,this.sendErrorWithCode(r,"failed_subscription_change")];case 7:throw i.sent(),r;case 8:return[2]}})})},e.prototype.processReSubscribe=function(){return o(this,void 0,void 0,function(){var t,e,n,r,o,a;return s(this,function(s){switch(s.label){case 0:return t={resubscribed:!1,domain:null},[4,this.getDomain()];case 1:return(e=s.sent())?(t.domain=e,[4,self.registration.pushManager.getSubscription()]):[3,6];case 2:return(n=s.sent())?(r=n.options,v.arrayBufferToBase64(r.applicationServerKey)===t.domain.vapid_public_key?[3,6]:(this.logger.info("vapid keys do not match - removing previous subscription"),[4,n.unsubscribe()])):[3,6];case 3:return s.sent(),o=i(i({},r),{userVisibleOnly:!0,applicationServerKey:v.base64ToArrayBuffer(t.domain.vapid_public_key)}),this.logger.info("processing new subscription",o),[4,self.registration.pushManager.subscribe(o)];case 4:return a=s.sent(),[4,this.sendReSubscriptionEvents({subscription_data:a.toJSON(),subscribed_url:self.location.href,page_url:self.location.href,domain_id:t.domain.id,domain_key:e.domain_key,sw:!0,migrated:!0,pushly_subscriber_data_present:!1})];case 5:s.sent(),t.resubscribed=!0,s.label=6;case 6:return[2,t]}})})},e.prototype.sendImpressionEvents=function(t){return o(this,void 0,void 0,function(){var e,n,r,i;return s(this,function(o){switch(o.label){case 0:return e=t.data||{},n=t.data,0===e.jxms?[3,2]:(r=n,[4,this.getSubscriptionData()]);case 1:r.subscription_data=o.sent(),o.label=2;case 2:return o.trys.push([2,4,,6]),[4,this.post(new a.StreamableEventModel(c.StreamableEventType.NOTIFICATION_IMPRESSION,n,this.distributionName))];case 3:return o.sent(),this.logger.info("Impression event sent"),[3,6];case 4:return i=o.sent(),w(i,{notification:t}),[4,this.sendErrorWithCode(i,"failed_impression_event_send")];case 5:return o.sent(),[3,6];case 6:return[2]}})})},e.prototype.sendClickEvents=function(t,e){return o(this,void 0,void 0,function(){var n;return s(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,4]),[4,this.post(new a.StreamableEventModel(c.StreamableEventType.NOTIFICATION_CLICK,i(i({},t.notification.data),e),this.distributionName))];case 1:return r.sent(),this.logger.info("Click event sent"),[3,4];case 2:return n=r.sent(),w(n,{notification:t.notification.data,clickEventData:e}),[4,this.sendErrorWithCode(n,"failed_click_event_send")];case 3:return r.sent(),[3,4];case 4:return[2]}})})},e.prototype.sendCloseEvents=function(t,e){return o(this,void 0,void 0,function(){var n;return s(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,4]),[4,this.post(new a.StreamableEventModel(c.StreamableEventType.NOTIFICATION_CLOSE,i(i({},t.notification.data),e),this.distributionName))];case 1:return r.sent(),this.logger.info("Close event sent"),[3,4];case 2:return n=r.sent(),w(n,{notification:t.notification.data,closeEventData:e}),[4,this.sendErrorWithCode(n,"failed_close_event_send")];case 3:return r.sent(),[3,4];case 4:return[2]}})})},e.prototype.sendSubscriptionChangeEvents=function(t,e){return o(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,4]),[4,this.post(new a.StreamableEventModel(c.StreamableEventType.SUBSCRIPTION_CHANGE,e,this.distributionName))];case 1:return n.sent(),this.logger.info("Subscription change event sent"),[3,4];case 2:return t=n.sent(),w(t,{changeEventData:e}),[4,this.sendErrorWithCode(t,"failed_subscription_change_event_send")];case 3:return n.sent(),[3,4];case 4:return[2]}})})},e.prototype.sendReSubscriptionEvents=function(t){return o(this,void 0,void 0,function(){var e,n;return s(this,function(r){switch(r.label){case 0:e=new a.StreamableEventModel(c.StreamableEventType.SUBSCRIBED,t,this.distributionName),r.label=1;case 1:return r.trys.push([1,3,,5]),[4,this.postback(d.NotificationPostbackType.POST,p.ALLOW_ENDPOINT,e.data)];case 2:return r.sent(),this.logger.info("Migrated subscription event sent"),[3,5];case 3:return n=r.sent(),w(n,{resubEventData:e.data}),[4,this.sendErrorWithCode(n,"failed_resubscribe_event_send")];case 4:return r.sent(),[3,5];case 5:return[2]}})})},e.prototype.sendPostbackEvents=function(t,e){return o(this,void 0,void 0,function(){var n,r,i=this;return s(this,function(o){switch(o.label){case 0:return n=[],(r=this.getActionPackage(t,e)).postbacks&&Array.isArray(r.postbacks)&&r.postbacks.forEach(function(t){return n.push(i.attachActionPostback(t))}),[4,Promise.all(n)];case 1:return o.sent(),[2]}})})},e.prototype.attachActionPostback=function(t){return o(this,void 0,void 0,function(){var e;return s(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,4]),[4,this.postback(t.type,t.url,t.payload)];case 1:return n.sent(),this.logger.info("postback completed",t),[3,4];case 2:return e=n.sent(),w(e,{postback:t}),[4,this.sendErrorWithCode(e,"failed_postback")];case 3:return n.sent(),[3,4];case 4:return[2]}})})},e.prototype.canSendError=function(t){var e=!0;try{var n=new RegExp(["AbortError"].map(function(t){return"("+t+")"}).join("|"),"i");(n.test(t.name)||n.test(t.message))&&(e=!1)}catch(t){}return e},e.prototype.sendErrorWithCode=function(t,e){return o(this,void 0,void 0,function(){var n,r,i,o,a,c,u;return s(this,function(s){switch(s.label){case 0:this.logger.error("[code:"+e+"]",t),n=this.logger.getFormattedLogs(),t=t||new Error("UNSET"),s.label=1;case 1:if(s.trys.push([1,4,,5]),t&&"message"in t&&/failed to fetch/i.test(t.message))return[2];r={sdk_version:2,error_type:"WorkerException:DBD",error_message:"[code:"+e+"] [name:"+t.name+"] "+t.message,error_code:e,backtrace:this.getBacktrace(t),logs:n,plugins:[],source:{application:p.PUSHLY_SW_APPLICATION_NAME,version:p.APPLICATION_VERSION,distribution:"deep-blue"},page_url:self.location.toString()};try{o=(i=t).context,a=i.code,o&&(r.context=o),a&&(r.origin_error_code=a)}catch(t){}return c={action:h.EventAction.Error,event_date:(new Date).toISOString(),meta:r},this.canSendError(t)?[4,this.postback(d.NotificationPostbackType.POST,p.EVENTS_ENDPOINT,c)]:[3,3];case 2:s.sent(),s.label=3;case 3:return[3,5];case 4:return u=s.sent(),this.logger.error(u),[3,5];case 5:return[2]}})})},e.prototype.getBacktrace=function(t){var e=[];try{_.parse(t).forEach(function(t){e.push({file:t.fileName,line:t.lineNumber,function:t.functionName})})}catch(t){}return e},e.prototype.isOperaOnMacOsGte14=function(){var t=!1;try{t=/(?:Mac OS X 10_14).+(?:\sOPR\/)/.test(navigator.userAgent)}catch(t){}return t},e.prototype.buildNotification=function(t){return{tag:t.data.collapse_key||t.data.notification_schedule_id||f.randomString(),body:t.notification.body,icon:t.data.icon,image:t.data.image,badge:t.data.badge,actions:this.buildActions(t.data),renotify:"false"!==t.data.renotify,requireInteraction:!this.isOperaOnMacOsGte14()&&"false"!==t.data.require_interaction,silent:"true"===t.data.silent,data:i({impression_type:"publisher_notification"},t.data)}},e.prototype.buildActions=function(t){var e=[];try{e=(t.pn_actions||[]).filter(function(t){return t.action&&t.title}).map(function(t){return{action:t.action,title:t.title}})}catch(t){}var n=m.test(navigator.userAgent),r=0===e.length,i=!!t.landing_url;try{n&&r&&(e=[{action:i?"win-open":"win-close",title:i?"Visit Site":"Dismiss"}])}catch(t){this.logger.warn("Unable to build default Windows action.")}return e},e.prototype.getActionPackage=function(t,e){var n={postbacks:[]};try{var r=(e.pn_actions||[]).find(function(e){return e.action.toString()===t.toString()});e.postbacks&&Array.isArray(e.postbacks[t])&&(n.postbacks=e.postbacks[t].slice(0,2));var i=e.landing_url;r?(n.seed=r,"OPEN_URL"===r.type?n.destination={type:u.ActionDestinationType.LINK,url:r.landing_url}:"CLOSE"===r.type&&(n.destination={type:u.ActionDestinationType.DISMISS})):"win-close"===t?n.destination={type:u.ActionDestinationType.DISMISS}:!i||"win-open"!==t&&"OPEN"!==t.toUpperCase()?e.action_destinations&&e.action_destinations[t]&&(n.destination=e.action_destinations[t]):n.destination={type:u.ActionDestinationType.LINK,url:i}}catch(t){this.logger.error(t)}return n},e.prototype.getSubscriptionData=function(){return o(this,void 0,void 0,function(){var t,e;return s(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.registration.pushManager.getSubscription()];case 1:return e=n.sent(),t=e.toJSON(),[3,3];case 2:return n.sent(),[3,3];case 3:return[2,t]}})})},e.prototype.postback=function(t,e,n){return o(this,void 0,void 0,function(){var r;return s(this,function(i){switch(i.label){case 0:return t!==d.NotificationPostbackType.POST?[3,2]:[4,y.ApiDataProvider.post(e,n,!0)];case 1:return r=i.sent(),[3,4];case 2:return[4,y.ApiDataProvider.get(e,!0)];case 3:r=i.sent(),i.label=4;case 4:return[2,r]}})})},e.prototype.ensureSessionId=function(){this.workerSessionId=this.workerSessionId||f.randomString()},e.prototype.ensureDependencies=function(){this.ensureSessionId(),this.registration=self.registration},e.prototype.addRecentlyClicked=function(t){t.notification&&this.recentlyClickedNotificationTags.push(t.notification.tag)},e.prototype.resetRecentlyClicked=function(){this.recentlyClickedNotificationTags=[]},e}(g.EventableModel);e.AbstractWorker=N},"./src/worker/api.data-provider.ts":function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(s,a)}c((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.ApiDataProvider=void 0;var o=n("./src/worker/utils.ts"),s=n("./src/worker/constants.ts"),a=n("./src/_utils/noop.ts"),c=function(){function t(){}return t.get=function(t,e){return r(this,void 0,void 0,function(){return i(this,function(n){switch(n.label){case 0:return[4,this.exec(t,"GET",{},void 0,e)];case 1:return[2,n.sent()]}})})},t.post=function(t,e,n){return void 0===e&&(e={}),r(this,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return[4,this.exec(t,"POST",{"content-type":"text/plain"},e,n)];case 1:return[2,r.sent()]}})})},t.exec=function(t,e,n,c,u){return r(this,void 0,void 0,function(){var r,l,f,p,h,d;return i(this,function(i){switch(i.label){case 0:r={method:e,headers:n};try{l=c?"string"==typeof c?JSON.parse(c):c:{},void 0!==(f=l.jxms)&&(u={ms:f})}catch(t){}return u?(p=0,p="object"==typeof u&&"ms"in u?u.ms:s.EVENT_JITTER_MAX_MILLISECONDS,[4,o.delayRandom(p).catch(a.noop)]):[3,2];case 1:i.sent(),i.label=2;case 2:try{"GET"!==e&&c&&(r.body="string"!=typeof c?JSON.stringify(c):c)}catch(t){}return[4,o.retryFetch(t,r)];case 3:if(!(h=i.sent()).ok)return[3,11];i.label=4;case 4:return i.trys.push([4,6,,7]),[4,h.json()];case 5:return d=i.sent(),[3,7];case 6:return i.sent(),[3,7];case 7:return i.trys.push([7,9,,10]),[4,h.text()];case 8:return d=i.sent(),[3,10];case 9:return i.sent(),[3,10];case 10:return[3,12];case 11:throw new Error("Endpoint returned with status "+h.statusText);case 12:return[2,d]}})})},t}();e.ApiDataProvider=c},"./src/worker/constants.ts":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EVENT_JITTER_MAX_MILLISECONDS=e.ENV_NAME_PRODUCTION=e.PUSHLY_SW_APPLICATION_NAME=e.CDN_ENDPOINT=e.EVENTS_ENDPOINT=e.ALLOW_ENDPOINT=e.APPLICATION_VERSION=e.ENV_NAME=void 0,e.ENV_NAME="production",e.APPLICATION_VERSION="25aae358bfa0d1c32ca05d8ced18b457bba9e813",e.ALLOW_ENDPOINT="https://k.p-n.io/allow",e.EVENTS_ENDPOINT="https://k.p-n.io/event-stream",e.CDN_ENDPOINT="https://cdn.p-n.io",e.PUSHLY_SW_APPLICATION_NAME="pushly-sw",e.ENV_NAME_PRODUCTION="production",e.EVENT_JITTER_MAX_MILLISECONDS=7e3},"./src/worker/custom/deep-blue.ts":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(s,a)}c((r=r.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.DeepBlueWorker=void 0;var a=n("./src/worker/abstract-worker.ts"),c=n("./src/worker/utils.ts"),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.init=function(){return o(this,void 0,void 0,function(){return s(this,function(t){return this.logger.setSubApplicationName("dbd"),this.logger.setColor("#5a9cec"),[2]})})},e.prototype.getPushEventJson=function(t){return o(this,void 0,void 0,function(){var e,n,r;return s(this,function(o){switch(o.label){case 0:if((e=t.data.json()).notification=e.notification||{},e.data=e.data||{},!e.data.content_webhook_url)return[3,4];n=e.data.content_webhook_url,o.label=1;case 1:return o.trys.push([1,3,,4]),this.logger.info("Trying Content Webhook: "+n),[4,c.retryFetch(n,{}).then(function(t){return t.json()})];case 2:return r=o.sent(),this.logger.info("Got Content Webhook Response:",r),e.notification=i(i({},e.notification),r.notification||{}),e.data=i(i({},e.data),r.data||{}),[3,4];case 3:return o.sent(),this.logger.info("Failed to fetch content from webhook."),[3,4];case 4:return[2,e]}})})},e}(a.AbstractWorker);e.DeepBlueWorker=u},"./src/worker/enums/action-destination-type.enum.ts":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ActionDestinationType=void 0,function(t){t.DISMISS="DISMISS",t.LINK="LINK"}(e.ActionDestinationType||(e.ActionDestinationType={}))},"./src/worker/enums/event-action.enum.ts":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EventAction=void 0,function(t){t.Error="error"}(e.EventAction||(e.EventAction={}))},"./src/worker/enums/notification-postback-type.enum.ts":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NotificationPostbackType=void 0,function(t){t.GET="GET",t.POST="POST"}(e.NotificationPostbackType||(e.NotificationPostbackType={}))},"./src/worker/enums/streamable-event-type.enum.ts":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StreamableEventType=void 0,function(t){t.ERROR="error",t.SUBSCRIBED="subscribed",t.SUBSCRIPTION_CHANGE="subscription_change",t.NOTIFICATION_IMPRESSION="notification_impression",t.NOTIFICATION_CLICK="notification_click",t.NOTIFICATION_CLOSE="notification_close"}(e.StreamableEventType||(e.StreamableEventType={}))},"./src/worker/logger.ts":function(t,e,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r};Object.defineProperty(e,"__esModule",{value:!0}),e.Logger=void 0;var i=n("./src/worker/constants.ts"),o=function(){function t(){}return t.print=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];try{for(var i=[],o=0,s=e;o<s.length;o++){var a=[t,s[o]];i.push(a),this._print(a)}this.logs=r(this.logs||[],i),this.logs.length>20&&(this.logs=this.logs.slice(-20))}catch(t){}},t.printAll=function(){for(var t=0,e=this.logs||[];t<e.length;t++){var n=e[t];this._print(n,!0)}},t.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.print.apply(this,r(["info"],t))},t.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.print.apply(this,r(["warn"],t))},t.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.print.apply(this,r(["error"],t))},t.getComputedApplicationName=function(){var t="pushly-sw";return this.subApplicationName&&(t=t+"::"+this.subApplicationName),t},t.setSubApplicationName=function(t){this.subApplicationName=t},t.setColor=function(t){this.color=t},t.setBackgroundColor=function(t){this.backgroundColor=t},t.getFormattedLogs=function(){var t=this.logs||[],e="["+this.getComputedApplicationName()+"]";return t.map(function(t){var n=t[0],r=t[1];return[n,e,r]})},t._print=function(t,e){void 0===e&&(e=!1);try{var n=t[0],o=t[1],s="["+this.getComputedApplicationName()+"]",a=o;o instanceof Object&&(a=JSON.stringify(o));var c=[];this.color&&c.push("color: "+this.color),this.backgroundColor&&c.push("background-color: "+this.backgroundColor);var u=[];u.push("%c"+s+" %c"+a),u.push(r(c,["font-weight: bold"]).join(";")),u.push(c.join(";")),(e||i.ENV_NAME!==i.ENV_NAME_PRODUCTION)&&console[n].apply(console,u)}catch(t){}},t.subApplicationName=null,t.color=null,t.backgroundColor=null,t}();e.Logger=o},"./src/worker/models/eventable.model.ts":function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(s,a)}c((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.EventableModel=void 0;var o=n("./src/worker/api.data-provider.ts"),s=n("./src/worker/enums/notification-postback-type.enum.ts"),a=function(){function t(){}return t.prototype.post=function(t){return r(this,void 0,void 0,function(){return i(this,function(e){return[2,t.getRequestObject().then(function(t){return o.ApiDataProvider.exec(t.endpoint,t.method,t.headers,t.body,!0)})]})})},t.prototype.postback=function(t,e,n){return r(this,void 0,void 0,function(){return i(this,function(r){return[2,t===s.NotificationPostbackType.POST?o.ApiDataProvider.post(e,n,!0):o.ApiDataProvider.get(e,!0)]})})},t}();e.EventableModel=a},"./src/worker/models/streamable-event.model.ts":function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(s,a)}c((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.StreamableEventModel=void 0;var s=n("./src/worker/utils.ts"),a=n("./src/worker/constants.ts"),c=function(){function t(t,e,n){this.type=t,this.id=s.randomString(),this.data=r(r({},e),{version:2,event_id:this.id,event_date:(new Date).toISOString(),action:t,source:{application:a.PUSHLY_SW_APPLICATION_NAME,version:a.APPLICATION_VERSION,distribution:n||"deep-blue"}})}return t.prototype.getRequestObject=function(){return i(this,void 0,void 0,function(){var t;return o(this,function(e){t=this.data;try{t=JSON.stringify(this.data)}catch(t){}return[2,{endpoint:a.EVENTS_ENDPOINT,method:"POST",headers:{"content-type":"text/plain"},body:t}]})})},t}();e.StreamableEventModel=c},"./src/worker/utils.ts":function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(s,a)}c((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.retryFetch=e.delayRandom=e.delay=e.buildRegexFromArray=e.tryParseInt=e.randomString=void 0;var o=n("./src/worker/logger.ts");e.randomString=function(t){void 0===t&&(t=32);for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",n="",r=0;r<t;r++)n+=e[Math.floor(Math.random()*e.length)];return/undefined/i.test(n)&&"crypto"in self&&"getRandomValues"in crypto&&"Uint32Array"in self&&(n=crypto.getRandomValues(new Uint32Array(4)).join("")),/undefined/i.test(n)&&(n="INVALID_RANDOM_STRING"),n},e.tryParseInt=function(t){var e,n=String(t);try{isNaN(n)||(e=parseInt(n,10))}catch(t){}return e},e.buildRegexFromArray=function(t){return new RegExp(t.map(function(t){return"("+t+")"}).join("|"),"i")},e.delay=function(t){return void 0===t&&(t=0),r(void 0,void 0,void 0,function(){return i(this,function(e){return[2,new Promise(function(e,n){setTimeout(function(){return e()},t)})]})})},e.delayRandom=function(t){return void 0===t&&(t=0),r(void 0,void 0,void 0,function(){return i(this,function(n){switch(n.label){case 0:return void 0!==t&&t>0&&(t=Math.round(Math.random()*t)),[4,e.delay(t)];case 1:return n.sent(),[2,t]}})})},e.retryFetch=function(t,n,s,a,c){return void 0===s&&(s=8),void 0===a&&(a=4),void 0===c&&(c=0),r(this,void 0,void 0,function(){var r,u,l,f,p,h,d;return i(this,function(i){switch(i.label){case 0:r=!0,u=1,i.label=1;case 1:if(!r)return[3,15];r=!1,l=null,i.label=2;case 2:return i.trys.push([2,8,,9]),[4,fetch(t,n)];case 3:if((f=i.sent()).ok)return[3,7];l="Retry fetch failed, "+f.status+", on url: "+t+".",i.label=4;case 4:return i.trys.push([4,6,,7]),[4,f.text()];case 5:return p=i.sent(),l=l+" [response] "+p+".",[3,7];case 6:return i.sent(),[3,7];case 7:return[3,9];case 8:return h=i.sent(),l=h,[3,9];case 9:return l?u<s?(d=u*(1e3*a),1===u&&c&&(d=u*(1e3*c)),o.Logger.info("Retrying in "+d+" ms..."),[4,e.delay(d)]):[3,11]:[3,13];case 10:return i.sent(),r=!0,u+=1,[3,12];case 11:throw o.Logger.error("Exceeded max fetched attempts on "+l),l instanceof Error?l:new Error(l);case 12:return[3,14];case 13:u>1&&o.Logger.info("Succeeded after "+u+" attempts."),i.label=14;case 14:return[3,1];case 15:return[2,f]}})})}}});