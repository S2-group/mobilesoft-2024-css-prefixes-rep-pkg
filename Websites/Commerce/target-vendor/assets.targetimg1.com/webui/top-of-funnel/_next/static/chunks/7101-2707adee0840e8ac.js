(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7101],{37101:function(e,r,t){"use strict";t.d(r,{QUERY_KEY_GET_PLP_SEARCH_V2:function(){return Q},preloadPlpSearchV2Query:function(){return x},usePlpSearchV2QueryVariables:function(){return H},usePlpSearchV2QueryWithVariables:function(){return K}}),t(74297);var l=t(59499),o=t(41609),a=t.n(o),u=t(44350),n=t(95252),i=t(37312),s=t(76655),d=t(27139),c=t(61464),v=t(24223),p=t(47269),f=t(31383),_=t(48332),y=t(94231),h=t(48914),P=t(25682),E=t(67294),S=t(11163),b=t(46879),O=t(80198),A=t(92340),g=t(95106),j=t(7535),m=t(6954),I=t(73781),R=t(65920),w=t(82823),q=t(11772),L=t(23100),G=t(67300);let T=e=>{if(!e.asPath)return;let r=(0,L.EG)(e.asPath),t=(0,L.jI)(e.query,"category"),l=(0,R.Yq)(e.asPath),o=(0,R.$L)(e.asPath),a=(0,R.O_)(e.asPath),u=(0,L.jI)(e.query,"auto_recover"),n="true"===(0,L.jI)(e.query,"facetRecovery")||void 0,i=(0,R.PC)(e),s=(0,L.lW)(e.query),d=(0,L.jI)(e.query,"kwr"),c=(0,L.jI)(e.query,"marketing_id"),v=(0,L.jI)(e.query,"maxPrice"),p=(0,L.jI)(e.query,"minPrice"),f=(0,L.jI)(e.query,"Nao"),_=(0,G.ew)(e.asPath),y=(0,L.jI)(e.query,"sortBy"),h="true"===(0,L.jI)(e.query,"splchkoff")||void 0,P=(0,L.jI)(e.query,"storeIdList"),E=Number.parseInt(null!=f?f:"",10)||0;return{auto_recover:u,brand:l,brand_id:o,category:null!=t?t:o?void 0:r,facet_recovery:n,faceted_value:i,keyword:s,kwr:d,marketing_id:c,max_price:v,min_price:p,offset:E,page:_,promo_id:a,sort_by:y,splchkoff:h,store_ids:P}};var k=t(40554),D=t.n(k);let N=e=>{let r=e.trim().length;return D()(e)>0&&r>4&&r<11},C=/^\d{3}[ -]\d{2}[ -]\d{4}$/,V=e=>C.test(e),Y=(e,r)=>e&&(!r||!N(r)&&!V(r));function B(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);r&&(l=l.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,l)}return t}function M(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?B(Object(t),!0).forEach(function(r){(0,l.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):B(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}let Q="@web/domain-product/get-plp-search-v2",U=new Set(["scheduled_delivery_store_id"]),W={},H=(e={})=>{var r,t;let{shouldNotWaitForCorrectVariablesOnHardRoute:l}=e,o=(0,S.useRouter)(),n=(0,E.useMemo)(()=>T(o),[o]),{guestLocation:s,queryState:d}=(0,g.N)(),{zipCode:c}=null!=s?s:{},{preferredStoreId:p,queryState:f}=(0,j.lo)(),_=null!=p?p:A.AP,{store_ids:y,enabled:P}=(0,w.P)(),L=Y(!!y,null==n?void 0:n.keyword),G=L?y:void 0,{scheduledDeliveryStoreId:k,queryState:D}=(0,m.G)(),N=null!==(r=(0,v.T)().GLOBAL_GUEST_ANONYMOUS_ESTIMATE_ENABLED)&&void 0!==r?r:(0,u.flags)("GLOBAL_GUEST_ANONYMOUS_ESTIMATE_ENABLED"),C=(0,b.Bz)(),V=(0,O.P)(),B=(0,b.bC)(),Q=!!(null==n?void 0:null===(t=n.faceted_value)||void 0===t?void 0:t.includes(q.lL)),H=(0,R.OS)(o.asPath)||(0,R.I$)(o.asPath),{include_sponsored:$,enabled:K}=(0,i.f)({shouldCheckRedOakPageSuppressDvm:!H}),x=(!!N&&!!C||V)&&K&&P&&(f.status===h.o.Success||f.status===h.o.Error)&&(d.status===h.o.Success||d.status===h.o.Error),z=x&&(!Q||D.status===h.o.Success||D.status===h.o.Error),F=x&&(D.status===h.o.Success||D.status===h.o.Error),Z=(0,E.useMemo)(()=>{let e=M(M({},n),{},{default_purchasability_filter:null==L?void 0:L.toString(),include_sponsored:!!$||void 0,member_id:B,pricing_store_id:_,scheduled_delivery_store_id:k,store_ids:G,zip:c});return e},[n,L,$,B,_,k,G,c]),J=a()(W.value)?[]:Object.entries(Z).filter(([e,r])=>{var t;return r!==(null===(t=W.value)||void 0===t?void 0:t[e])}).map(([e])=>e),X=J.some(e=>!U.has(e)),ee=(0,I.A)(),er=l&&!ee,et=W.value&&er&&!X?W.value:Z,el=(0,E.useMemo)(()=>({variables:er?et:Z,enabled:er?z:F}),[er,et,z,Z,F]);return el},{useQuery:$}=(0,P.J)({name:Q,defaultOptions:{staleTime:9e5,cacheTime:9e5,keepPreviousData:!0},keyFn:e=>{var r;return[Q,M(M({},e),{},{offset:null==e?void 0:null===(r=e.offset)||void 0===r?void 0:r.toString()})]},queryFn:async e=>{W.value||(W.value=e);let{apiKey:r,baseUrl:l,apis:{product:{endpointPaths:o}}}=(0,u.config)().services.redskyAggregations,a=null==o?void 0:o.plpSearchV2;if(!a)throw Error("path not defined for plpSearchV2 query");let i=await (0,d.W)(),{auto_recover:s,brand:v,brand_id:h,category:P,default_purchasability_filter:E,facet_recovery:S,faceted_value:b,include_sponsored:O,keyword:g,kwr:j,marketing_id:m,max_price:I,member_id:R,min_price:w,offset:q,page:L,pricing_store_id:G=A.AP,promo_id:T,scheduled_delivery_store_id:k,skip_price_promo:D,sort_by:N,splchkoff:C,store_ids:V,zip:Y}=null!=e?e:{};if(q&&q>=1500)throw Error("Offset too high for plpSearchV2 query");let B=(0,f.WE)(),Q=(0,n.k)()||"0",U={key:r,effective_date:i,auto_recover:s,brand:v,brand_id:h,category:P&&!P.includes("|")?P:void 0,channel:"WEB",count:24,default_purchasability_filter:E,facet_recovery:S,faceted_value:b,include_sponsored:O,keyword:g,kwr:j,marketing_id:m,max_price:I,member_id:R,min_price:null!=w?w:I?"0":void 0,offset:q,page:L,platform:(0,_.o$)(),pricing_store_id:G,promo_id:T,scheduled_delivery_store_id:k,skip_price_promo:D,sort_by:N,splchkoff:C,store_ids:V,useragent:B,visitor_id:Q,zip:Y},H=p.Z.buildURLWithParams(a,U,l),{data:$,ok:K,statusText:x}=await (0,c.G)(H,{errorTag:y.jD.REDSKY_AGGREGATIONS_PLP_SEARCH_API_ERROR,partialErrorTag:y.jD.REDSKY_AGGREGATIONS_PLP_SEARCH_PARTIAL_API_ERROR,timerTag:y.sO.REDSKY_AGGREGATIONS_PLP_SEARCH_API_CALL,importQuerySource:()=>t.e(8408).then(t.t.bind(t,15225,17))});if(K){var z;return null!==(z=M(M({},null==$?void 0:$.data),null==$?void 0:$.extensions))&&void 0!==z?z:null}throw Error(`${x}`)}}),K=(e,r={})=>{let{variables:t,enabled:l}=H(r);return $(M(M({},r.shouldUseOnlyVariableOverrides?{}:t),e),{enabled:!1!==r.enabled&&l})},x=async(e,r)=>{let t=T(e),l=M(M({},t),{},{default_purchasability_filter:"false",pricing_store_id:A.AP},r);try{var o,a,u,n,i,d,c;let r=await e.preloadInitialQuery($,l),t=null==r?void 0:null===(o=r.data)||void 0===o?void 0:o.search,v=(0,s.th)(t),p=null==t?void 0:null===(a=t.search_response)||void 0===a?void 0:a.metadata;if(null===(u=e.res)||void 0===u||null===(n=u.injectedVariables)||void 0===n||n.set("plpPageSearchResponse",{offset:null==p?void 0:p.offset,totalResults:null==p?void 0:p.total_results}),v&&(null===(i=e.res)||void 0===i||i.writeHead(302,{Location:v}),null===(d=e.res)||void 0===d||d.end()),null!=r&&r.error)throw Error(null==r?void 0:null===(c=r.error)||void 0===c?void 0:c.message);return l}catch(e){return}}},74297:function(){}}]);