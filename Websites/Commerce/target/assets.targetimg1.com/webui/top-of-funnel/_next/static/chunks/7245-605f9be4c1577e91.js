"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7245],{37245:function(e,t,r){r.d(t,{x:function(){return o},Q:function(){return ec}});var n,o,i=r(59499),a=r(85893),l=r(67294),s=r(96333),c=r(17619),f=r(19521),p=r(56947),u=r.n(p),d=r(20041),O=r(47052),v=r(4730),m=r(99119);function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}let g=(0,l.memo)(e=>(0,a.jsx)(m.f,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({_name:"Checkmark",_src:"assets/decorative/light/Checkmark.svg",_aspectRatio:1},e)));var b=r(57199);function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}let _=(0,l.memo)(e=>(0,a.jsx)(b.J,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({_name:"QuantityAdd",_src:"assets/glyph/QuantityAdd.svg",_viewBox:"0 0 24 24"},e)));var E=r(50667);let w=["className","data-test","hasWarning","isConfirmed","isFullWidth","isPending","onClick","size"];function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let R=(0,l.forwardRef)((e,t)=>{let{className:r,"data-test":n,hasWarning:o,isConfirmed:i,isFullWidth:l,isPending:s,onClick:c,size:f}=e,p=(0,v.Z)(e,w),d=Number.parseInt("sm"===f?u().font.size.text.medium:u().font.size.text.base,10);return(0,a.jsx)(E.i,F(F({confirmedText:"Offer saved",initialText:"Save offer",warningText:"Offer not saved. Try again"},p),{},{className:r,"data-test":n,hasWarning:o,isConfirmed:i,isFullWidth:l,isPending:s,onClick:c,ref:t,renderLeadingConfirmed:(0,a.jsx)(g,{color:u().colors.palette.green.light,width:d}),renderLeadingInitial:(0,a.jsx)(_,{color:u().colors.palette.white,width:d}),size:f}))});R.displayName="ButtonOffer";let P=(0,f.ZP)(R).withConfig({displayName:"ButtonOfferSecondary",componentId:"sc-272k6x-0"})(["button{","}"],({isConfirmed:e})=>e?`
      ${O.QJ}

      &:hover {
        ${O.Ky}
      }

      &:active {
        ${O.BH}
      }
      svg stop {
        stop-color: ${p.colors.palette.green.light};
      }
  `:`
      font-weight: normal;
      ${d._f}

      &:hover {
        ${d.ID}
      }

      &:active {
        ${d.h5}
        [data-icon-name="NavigationPlusFill"] {
          fill: ${p.colors.palette.white};
        }
        svg stop {
          stop-color: ${p.colors.palette.white};
        }
      }
      [data-icon-name="NavigationPlusFill"] {
        fill: ${p.colors.palette.black};
      }
      svg stop {
        stop-color: ${p.colors.palette.gray.medium};
      }
    `);P.displayName="ButtonOfferSecondary";var D=r(55139),k=r(77110),I=r(44281),S=r(35216),A=r(44350),x=r(37673);let C=async e=>{let{apis:{loyaltyGuestOfferLists:t},baseUrl:r,circleOfferLoyaltyKeys:n}=(0,A.config)().services.apiPlatform,o=`${r}/${t.endpointPaths.postOfferV1}/${null==e?void 0:e.offerId}`,{data:i,ok:a,statusText:l}=await (0,x.v_)(o,{headers:{Authorization:n.loyaltyClientKey,"x-api-key":n.loyaltyApiKey},parameters:{location_id:null==e?void 0:e.storeId},errorTag:"circle_post_offer_error",timerTag:"circle_post_offer_call",credentials:"include"});if(a)return i;throw Error(`${l}`)},{useMutation:N}=(0,S.F)({name:"@web/domain-circle-offers/post-offer-v1",mutationFn:e=>C(e)}),$=["LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED"],L=async e=>{let{apis:{offersV16:t},baseUrl:r}=(0,A.config)().services.circle,n=new URL(`${r}/${t.endpointPaths.postOfferV16}/${null==e?void 0:e.offerId}`).toString(),{data:o,ok:i,statusText:a}=await (0,x.v_)(n,{errorTag:"circle_post_offer_error",timerTag:"circle_post_offer_call",credentials:"include"});if(i)return o;throw Error(`${a}`)},{useMutation:T}=(0,S.F)({name:"@web/domain-circle-offers/post-offer-v16",mutationFn:e=>{let t=null!=e?e:{},{LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:r=!1}=t,n=(0,v.Z)(t,$),o=(0,A.flags)("LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED")||r;return o?C(n):L(n)}}),M=async e=>{let{apis:{loyaltyGuestOfferLists:t},circleOfferLoyaltyKeys:r,baseUrl:n}=(0,A.config)().services.apiPlatform,o=`${n}/${t.endpointPaths.deleteOfferV1}/${null==e?void 0:e.offerId}`,{data:i,ok:a,statusText:l}=await (0,x.IV)(o,{headers:{Authorization:r.loyaltyClientKey,"x-api-key":r.loyaltyApiKey},errorTag:"circle_delete_offer_error",timerTag:"circle_delete_offer_call",credentials:"include"});if(a)return i;throw Error(`${l}`)},{useMutation:V}=(0,S.F)({name:"@web/domain-circle-offers/delete-offer-v1",mutationFn:e=>M(e)}),B=["LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED"],z=async e=>{let{apis:{offersV16:t},baseUrl:r}=(0,A.config)().services.circle,n=new URL(`${r}/${t.endpointPaths.deleteOfferV16}/${null==e?void 0:e.offerId}`).toString(),{data:o,ok:i,statusText:a}=await (0,x.IV)(n,{errorTag:"circle_delete_offer_error",timerTag:"circle_delete_offer_call",credentials:"include"});if(i)return o;throw Error(`${a}`)},{useMutation:Z}=(0,S.F)({name:"@web/domain-circle-offers/delete-offer-v16",mutationFn:e=>{let t=null!=e?e:{},{LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:r=!1}=t,n=(0,v.Z)(t,B),o=(0,A.flags)("LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED")||r;return o?M(n):z(n)}});var K=r(26797),Y=r(67300),G=r(6153),J=r(43430);function W(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?W(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let Q=e=>{let{trackEvent:t}=(0,J.rS)(),r=(0,G.Kk)(),n=(0,Y.ew)(r),i=null==e?void 0:e.strategyId;return a=>{let l,s;let{offerId:c,action:f,offerAriaLabel:p}=null!=a?a:{};c&&(f===o.ADDED_OFFER?l=!0:f===o.ADD_OFFER_ERROR&&(l=!1),f===o.REMOVED_OFFER?s=!0:f===o.REMOVE_OFFER_ERROR&&(s=!1),t({appState:{url:r,cmsPageId:n},guest:{eventType:"click"},offerInfo:H(H(H({},l?{addOffer:l}:{}),s?{removeOffer:s}:{}),{},{offers:[{offerId:c,offerSelected:void 0!==l||void 0!==s,offerType:"cartwheel"}]}),promotionInfo:{promos:[{id:c,omtOfferId:c,added:l,removed:s,longTagSpecialOffer:p}]}}),i&&(0,J.OK)({recClick:{type:"promo",offerId:c,position:null==e?void 0:e.position,strategyId:null==e?void 0:e.strategyId,strategyName:null==e?void 0:e.strategyName}}))}};var U=r(86235);let q=()=>{let{openJoinCircleModal:e,closeJoinCircleModal:t,isCircleEnrolled:r,isGuestLoggedIn:n}=(0,l.useContext)(U.j);return{closeJoinCircleModal:t,openJoinCircleModal:e,isCircleEnrolled:r,isGuestLoggedIn:n}};var X=r(78503),ee=r(36679),et=r(13347);let er=({isPopoverOpen:e,offerButtonRef:t,setIsPopoverOpenToggle:r,isErrorState:n,errorMessage:o=K._r,isIconOnly:i})=>{let s=(0,l.useRef)(null),c=(0,l.useCallback)(()=>{var e;null===(e=s.current)||void 0===e||e.focus()},[]),f=(0,l.useCallback)(e=>{null==e||e.preventDefault(),(0,et.zB)(window.location.href)},[]);return(0,a.jsx)(D.J,{isOpen:e,onOpen:c,renderInline:!0,role:n?"alert":"tooltip",tailPosition:i?"end":void 0,target:t,toggle:r,variant:n?"warning":"primary",zIndex:1100,children:n?(0,a.jsx)("span",{"data-test":"save-offer-popover-error",ref:s,tabIndex:-1,children:o}):(0,a.jsx)(ee.F,{className:"h-margin-a-tiny",color:"onDark","data-test":"save-offer-popover-sign-in-link",onClick:f,ref:s,underline:"always",children:K.IY})})};er.displayName="SaveCircleOfferPopover";let en=f.ZP.svg.withConfig({displayName:"AnimatedIcon__AnimatedSvg",componentId:"sc-x6qm3h-0"})([".plus{clip-path:",";transition:clip-path 300ms;transition-delay:100ms;",";}.checkmark{clip-path:inset(0 100% 0 0);transition:clip-path 100ms;transition-delay:0;","}@media (prefers-reduced-motion){.plus,.checkmark{transition:none;transition-delay:0;}}"],"polygon(0% 0%, 0% 100%, 50% 100%, 50% 50%, 50% 50%, 50% 50%, 50% 50%, 50% 100%, 100% 100%, 100% 0%)",e=>e.isOfferAdded?`
    clip-path: polygon(0% 0%, 0% 100%, 0 100%, 0 0, 100% 0, 100% 100%, 0 100%, 0 100%, 100% 100%, 100% 0%);
    transition: clip-path 100ms;
    transition-delay: 0;
    `:"",e=>e.isOfferAdded?`
    clip-path: inset(0);
    transition: clip-path 300ms;
    transition-delay: 100ms;
    `:""),eo=({isOfferAdded:e=!1,size:t=24})=>(0,a.jsxs)(en,{focusable:"false",height:t,isOfferAdded:e,role:"presentation",viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",children:[(0,a.jsx)("path",{className:"plus",d:"M12.75 3.25v8h8v1.5h-8v8h-1.5v-8h-8v-1.5h8v-8z",fill:p.colors.palette.red.default}),(0,a.jsx)("path",{className:"checkmark",d:"M8.923 16.443l-4.395-4.364-1.056 1.064 5.451 5.414L20.528 7.032l-1.056-1.064z",fill:p.colors.palette.green.light})]});eo.displayName="AnimatedIcon";let ei=f.ZP.a.withConfig({displayName:"styles__PreLineLink",componentId:"sc-122dvwh-0"})(["white-space:pre-line;"]);function ea(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function el(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ea(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ea(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(n=o||(o={})).ADDED_OFFER="ADDED_OFFER",n.ADD_OFFER_ERROR="ADD_OFFER_ERROR",n.REMOVED_OFFER="REMOVED_OFFER",n.REMOVE_OFFER_ERROR="REMOVE_OFFER_ERROR";let es=e=>e===K.a0?K.rL:e===K.mF?K.b0:void 0,ec=({buttonSize:e,confirmedText:t,initialText:r,isOfferAddedDefault:n,offerId:i,offerAriaLabel:f,onAddOffer:p,onRemoveOffer:u,variation:d,trackingDetails:O,shouldTrack:v=!0})=>{var m;let[y,g]=(0,X.H)(),{openJoinCircleModal:b,isGuestLoggedIn:h,isCircleEnrolled:_}=q(),E=(0,I.l)(),{pricingStoreId:w}=(0,s.K)(),{screenSmMax:j}=(0,c.l)(),{0:F,1:S}=(0,l.useState)(void 0),{0:A,1:x}=(0,l.useState)(!1),{0:C,1:N}=(0,l.useState)(!1),$=Q(O),L=n?K.mF:K.KL,{0:M,1:V}=(0,l.useState)(L),{0:B,1:z}=(0,l.useState)(!1),Y=i?null==y?void 0:null===(m=y[i])||void 0===m?void 0:m.added:void 0,{0:G,1:J}=(0,l.useState)("");(0,l.useEffect)(()=>{if(!0===Y){if(M===K.mF)return;return V(K.mF)}if(!1===Y){if(M===K.a0)return;return V(K.a0)}V(L)},[Y,L,M,i]);let W=(0,l.useCallback)(e=>{let t={action:e,offerId:i,offerAriaLabel:f};null==p||p(t),v&&$(t)},[i,f,p,v,$]),H=(0,l.useCallback)(e=>{let t={action:e,offerId:i,offerAriaLabel:f};null==u||u(t),v&&$(t)},[i,f,u,v,$]),U=(0,l.useCallback)(e=>{if((null==e?void 0:e.status)===409){var t,r,n;S(null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:null===(n=r.errors)||void 0===n?void 0:n.NOT_ENOUGH_SLOTS)}z(!0),W(o.ADD_OFFER_ERROR),V(K.a0)},[W]),ee=(0,l.useCallback)(()=>{B&&z(!1),W(o.ADDED_OFFER),V(K.mF),J("Offer saved"),g&&g({type:K.NE.ADD_OFFER,value:{offerId:i}})},[W,B,i,g]),[et]=T({onError:U,onSuccess:ee}),en=(0,l.useCallback)(()=>{var e;N(!1),null===(e=eu.current)||void 0===e||e.focus()},[]),ea=(0,l.useCallback)(()=>{B&&z(!1),H(o.REMOVED_OFFER),V(K.a0),J("Offer removed"),g&&g({type:K.NE.REMOVE_OFFER,value:{offerId:i}})},[H,B,i,g]),ec=(0,l.useCallback)(()=>{z(!0),H(o.REMOVE_OFFER_ERROR),V(K.mF)},[H]),[ef]=Z({onError:ec,onSuccess:ea});(0,l.useEffect)(()=>{B&&x(e=>!e||e)},[B]);let ep=(0,l.useCallback)(async()=>{if(!B){if(!h)return x(!0);if(h&&!_)return b();switch(V(K.rR),M){case K.KL:case K.a0:if(i)return N(!0),et({offerId:i,LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:E,storeId:w});break;case K.mF:if(i)return ef({offerId:i,LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:E})}}},[et,B,ef,_,h,i,M,b,x,w,E]),eu=(0,l.useRef)(null),ed=(0,l.useCallback)(()=>{x(e=>(e&&(S(void 0),z(!1)),!e))},[]),eO="secondary"===d?P:R,ev="iconOnly"===d,em=(0,l.useRef)(null),ey=(0,l.useCallback)(()=>{var e;null===(e=em.current)||void 0===e||e.focus()},[]);return i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(er,{errorMessage:null!=F?F:es(M),isErrorState:B,isIconOnly:ev,isPopoverOpen:A,offerButtonRef:eu,setIsPopoverOpenToggle:ed}),i===K.U4&&(0,a.jsx)(D.J,{isDismissible:!0,isOpen:C,onDismiss:en,onOpen:ey,renderInline:!0,role:"tooltip",target:eu,variant:"primary",children:(0,a.jsx)(ei,{ref:em,tabIndex:-1,children:K.YJ})}),ev?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"h-sr-only",role:"alert",children:G}),(0,a.jsx)(k.H,{"aria-label":M===K.mF?`Remove offer: ${f}`:`Save offer: ${f}`,className:"h-padding-a-tiny",onClick:ep,ref:eu,renderIcon:(0,a.jsx)(eo,{isOfferAdded:M===K.mF,size:36}),type:"button"})]}):(0,a.jsx)(eO,el(el({"aria-label":M===K.mF?`Remove offer: ${f}`:`Save offer: ${f}`,"data-test":"save-circle-offer-button",isConfirmed:M===K.mF,isFullWidth:!0,isPending:M===K.rR,onClick:ep,ref:eu,size:null!=e?e:j?"sm":"lg"},t?{confirmedText:t}:{}),r?{initialText:r}:{}))]}):null};ec.displayName="SaveCircleOfferButton"}}]);